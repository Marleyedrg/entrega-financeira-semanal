!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}(),window.__APP_BASE_PATH="/",window.location.pathname.includes("/entrega-financeira-semanal/")&&(window.__APP_BASE_PATH="/entrega-financeira-semanal/"),window.getResourcePath=function(e){if(!e)return e;if(e.startsWith("http")||e.startsWith("//")||e.startsWith("data:"))return e;return window.__APP_BASE_PATH+(e.startsWith("/")?e.substring(1):e)};const e={delivery:{id:{type:"string",required:!1},orderNumber:{type:"string",required:!0,validate:e=>e&&e.trim().length>0,message:"Número do pedido é obrigatório"},fee:{type:"number",required:!1,validate:e=>null===e||""===e||void 0===e||parseFloat(e)>=0,message:"Taxa não pode ser negativa"},date:{type:"string",required:!0,validate:e=>e&&/^\d{4}-\d{2}-\d{2}$/.test(e),message:"Data deve estar no formato YYYY-MM-DD"},image:{type:"any",required:!0,message:"O comprovante é obrigatório"},status:{type:"string",required:!1,validate:e=>!e||["pending","completed"].includes(e),message:'Status deve ser "pending" ou "completed"'}},gasEntry:{id:{type:"string",required:!1},date:{type:"string",required:!0,validate:e=>e&&/^\d{4}-\d{2}-\d{2}$/.test(e),message:"Data deve estar no formato YYYY-MM-DD"},amount:{type:"number",required:!0,validate:e=>e&&parseFloat(e)>0,message:"Valor deve ser maior que zero"},image:{type:"any",required:!1}}};function t(t,n,o={}){const a=e[n];if(!a)throw new Error(`Esquema de validação não encontrado: ${n}`);const s=[],i={isValid:!0,errors:[]};if(Object.entries(a).forEach((([e,n])=>{const o=t[e];if(!n.required||null!=o&&""!==o){if(n.required||null!=o&&""!==o){if("any"!==n.type){const t=typeof o;if("number"===n.type){if("number"!==t&&isNaN(parseFloat(o)))return void s.push({field:e,message:n.message||`O campo ${e} deve ser um número`})}else if(t!==n.type)return void s.push({field:e,message:n.message||`O campo ${e} deve ser do tipo ${n.type}`})}n.validate&&"function"==typeof n.validate&&(n.validate(o,t)||s.push({field:e,message:n.message||`O valor para ${e} é inválido`}))}}else s.push({field:e,message:n.message||`O campo ${e} é obrigatório`})})),0===s.length&&!1!==o.checkBusinessRules){const e=function(e,t,n={}){const o=[];if("delivery"===t){const t=Ae(e.date);if(f.some((o=>o.orderNumber===e.orderNumber&&Ae(o.date)===t&&(!n.excludeId||o.id!==n.excludeId)))&&o.push({field:"orderNumber",message:`Já existe um pedido com o número ${e.orderNumber} na data ${e.date}`}),n.preventPastDates){const t=new Date(e.date),a=new Date;if(a.setHours(0,0,0,0),t<a){const e=Math.floor((a-t)/864e5);n.maxPastDays,o.push({field:"date",message:`A data selecionada é muito antiga (${e} dias atrás)`})}}}else if("gasEntry"===t){parseFloat(e.amount)>500&&o.push({field:"amount",message:"Valor de abastecimento suspeito (muito alto)",isSuspicious:!0});const t=Ae(e.date);h.filter((e=>Ae(e.date)===t&&(!n.excludeId||e.id!==n.excludeId))).length>0&&!n.allowMultipleGasEntries&&o.push({field:"date",message:"Já existe um abastecimento registrado nesta data",isSuspicious:!0})}return o}(t,n,o);s.push(...e)}return s.length>0&&(i.isValid=!1,i.errors=s),i}function n(e,n){const o={isValid:!0,errors:[],validItems:[],invalidItems:[]};return e.forEach(((e,a)=>{const s=t(e,n,{checkBusinessRules:!1});s.isValid?o.validItems.push(e):(o.isValid=!1,s.errors.forEach((t=>{o.errors.push({...t,index:a,item:e})})),o.invalidItems.push({index:a,item:e,errors:s.errors}))})),o}function o(){const e=n(f,"delivery"),t=n(h,"gasEntry");return{isValid:e.isValid&&t.isValid,deliveries:e,gasEntries:t,timestamp:Date.now()}}const a=`tab_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;let s=null,i=Date.now();const r={isPrimary:!1,connectedTabs:0,lastSyncTime:null,pendingChanges:[],syncInProgress:!1};function c(){try{s=new BroadcastChannel("entrega_financeira_sync"),s.onmessage=e=>{l(e.data)},s.postMessage({type:"TAB_CONNECTED",sessionId:a,timestamp:Date.now()}),console.log("Broadcast Channel inicializado")}catch(e){console.warn("Broadcast Channel não suportado, usando fallback com localStorage"),window.addEventListener("storage",(e=>{if("deliveries"===e.key||"gasEntries"===e.key)!function(e){"deliveries"!==e.key&&"gasEntries"!==e.key||e.newValue!==e.oldValue&&(r.syncInProgress||u())}(e);else if("sync_message"===e.key)try{l(JSON.parse(e.newValue))}catch(t){console.error("Erro ao processar mensagem de sincronização:",t)}})),localStorage.setItem("sync_message",JSON.stringify({type:"TAB_CONNECTED",sessionId:a,timestamp:Date.now()}))}return m(),window.addEventListener("beforeunload",(()=>{d({type:"TAB_DISCONNECTED",sessionId:a,timestamp:Date.now()})})),setInterval(m,3e4),{sessionId:a,isPrimary:()=>r.isPrimary}}function d(e){e.sessionId=a,s?s.postMessage(e):(localStorage.setItem("sync_message",JSON.stringify(e)),setTimeout((()=>{localStorage.removeItem("sync_message")}),50))}function l(e){if(e&&e.sessionId!==a&&!(e.timestamp&&Date.now()-e.timestamp>6e4))switch(e.type){case"TAB_CONNECTED":r.connectedTabs++,m();break;case"TAB_DISCONNECTED":r.connectedTabs=Math.max(0,r.connectedTabs-1),m();break;case"PRIMARY_CLAIMING":r.isPrimary&&d({type:"PRIMARY_CLAIMED",timestamp:Date.now()});break;case"PRIMARY_CLAIMED":r.isPrimary=!1;break;case"DATA_CHANGED":e.timestamp>i&&(i=e.timestamp,u());break;case"SYNC_REQUEST":r.isPrimary&&d({type:"SYNC_RESPONSE",timestamp:Date.now()});break;case"FULL_CLEAR":!function(){i=Date.now();try{s&&(s.close(),setTimeout((()=>{try{s=new BroadcastChannel("entrega_financeira_sync"),s.onmessage=e=>{l(e.data)}}catch(e){console.error("Erro ao recriar canal após limpeza:",e)}}),300)),u(!0),console.log("Sincronização completa após limpeza de dados")}catch(e){console.error("Erro ao processar limpeza de dados:",e)}}()}}function m(){0!==r.connectedTabs||r.isPrimary||(d({type:"PRIMARY_CLAIMING",timestamp:Date.now()}),setTimeout((()=>{r.isPrimary||(r.isPrimary=!0,console.log("Esta aba agora é primária"),u())}),300))}function u(e=!1){if(!r.syncInProgress||e){r.syncInProgress=!0;try{if(console.log("Sincronizando dados da memória com localStorage..."),e){for(console.log("Executando sincronização forçada completa");f.length>0;)f.pop();for(;h.length>0;)h.pop()}I(),x(),$(),P(),M(),r.lastSyncTime=Date.now(),console.log("Sincronização completa:",new Date(r.lastSyncTime).toLocaleTimeString())}catch(t){console.error("Erro durante sincronização:",t),Ge("Erro ao sincronizar dados","error")}finally{r.syncInProgress=!1}}}function g(e="update"){i=Date.now(),d({type:"DATA_CHANGED",changeType:e,timestamp:i})}function p(){return d({type:"SYNC_REQUEST",timestamp:Date.now()}),u(),r.lastSyncTime}function v(){return{...r,sessionId:a}}let f=[],h=[],y=null;function E(){try{const e=localStorage.getItem("deliveries");f=e?JSON.parse(e).map((e=>({...e,fee:parseFloat(e.fee)||0,id:e.id||String(Date.now()),date:Ae(e.date),status:e.status||(parseFloat(e.fee)>0?"completed":"pending")}))):[];const t=localStorage.getItem("gasEntries");h=t?JSON.parse(t).map((e=>({...e,amount:parseFloat(e.amount)||0,id:e.id||String(Date.now()),date:Ae(e.date)}))):[],L();const n=Date.now();(!y||n-y>36e5)&&(!function(){const e=o();e.isValid||(console.warn("Problemas de integridade nos dados:",e),e.deliveries.invalidItems.length>0&&(e.deliveries.invalidItems.forEach((e=>{const t=f.findIndex((t=>t.id===e.item.id));-1!==t&&(f[t].status||(f[t].status=parseFloat(f[t].fee)>0?"completed":"pending"),f[t].id||(f[t].id=String(Date.now())+"_"+Math.random().toString(36).substring(2,9)))})),localStorage.setItem("deliveries",JSON.stringify(f))),e.gasEntries.invalidItems.length>0&&(e.gasEntries.invalidItems.forEach((e=>{const t=h.findIndex((t=>t.id===e.item.id));-1!==t&&(h[t].id||(h[t].id=String(Date.now())+"_"+Math.random().toString(36).substring(2,9)))})),localStorage.setItem("gasEntries",JSON.stringify(h))))}(),y=n),S(),D(),$(),M()}catch(e){console.error("Erro ao carregar dados:",e),Ge("Erro ao carregar dados do armazenamento local","error"),f=[],h=[]}}function w(){try{L(),localStorage.setItem("deliveries",JSON.stringify(f)),P(),S(),$(),g("deliveries")}catch(e){console.error("Erro ao salvar entregas:",e),Ge("Erro ao salvar entregas","error")}}function b(){try{localStorage.setItem("gasEntries",JSON.stringify(h)),P(),D(),$(),g("gasEntries")}catch(e){console.error("Erro ao salvar registros de gasolina:",e),Ge("Erro ao salvar registros de gasolina","error")}}function I(){E()}function x(){E()}function L(){f.sort(((e,t)=>{const n=new Date(t.date)-new Date(e.date);return 0!==n?n:e.orderNumber.localeCompare(t.orderNumber,void 0,{numeric:!0,sensitivity:"base"})}))}function $(){const e=f.reduce(((e,t)=>e+(parseFloat(t.fee)||0)),0),t=h.reduce(((e,t)=>e+(parseFloat(t.amount)||0)),0);document.getElementById("totalFees").textContent=Oe(e),document.getElementById("totalGas").textContent=Oe(t);const n=e-t,o=document.getElementById("netProfit");o.textContent=Oe(n),o.className=n>=0?"total-profit":"total-loss",P(),M()}function S(){const e=document.getElementById("deliveriesTableBody");if(!e)return;e.innerHTML="";const t={};f.forEach((e=>{const n=e.date||Re();t[n]||(t[n]={entries:[],totalFees:0}),t[n].entries.push(e);const o=parseFloat(e.fee)||0;t[n].totalFees+=o}));const n=Object.keys(t).sort(((e,t)=>new Date(t)-new Date(e)));if(n.forEach((n=>{const o=t[n].entries,a=t[n].totalFees,s=document.createElement("tr");s.className="date-header",s.innerHTML=`\n      <td colspan="4">\n        <div class="date-header-content">\n          <span class="date-label">${ze(n)}</span>\n          <span class="weekday-label">(${Fe(n)})</span>\n          <div class="date-summary">\n            <span class="delivery-count">${o.length} entregas</span>\n            <span class="total-fees">R$ ${Oe(a)}</span>\n          </div>\n        </div>\n      </td>\n    `,e.appendChild(s),o.forEach((t=>{const n=document.createElement("tr");n.className="delivery-row";let o="Desconhecido",a="";"pending"===t.status?(o="Pendente",a="status-pending"):"completed"===t.status||parseFloat(t.fee)>0?(o="Concluído",a="status-completed"):(o="Pendente",a="status-pending");const s=document.createTextNode(t.orderNumber||"").textContent,i=parseFloat(t.fee)||0;n.innerHTML=`\n        <td>${s}</td>\n        <td>R$ ${Oe(i)}</td>\n        <td><span class="${a}">${o}</span></td>\n        <td class="actions-cell">\n          <button class="action-button" title="Ver imagem">\n            <i class="fas fa-image"></i>\n          </button>\n          <button class="action-button" title="Editar">\n            <i class="fas fa-edit"></i>\n          </button>\n          <button class="action-button delete" title="Excluir">\n            <i class="fas fa-trash"></i>\n          </button>\n        </td>\n      `;const r=n.querySelector(".action-button:nth-child(1)"),c=n.querySelector(".action-button:nth-child(2)"),d=n.querySelector(".action-button:nth-child(3)");r.addEventListener("click",(()=>{t.image?window.showImageModal(t.image):Ge("Sem comprovante para este pedido","info")})),c.addEventListener("click",(()=>{window.editDelivery(t.id)})),d.addEventListener("click",(()=>{const e=t.orderNumber||"desconhecido";window.confirmDeliveryDeletion?window.confirmDeliveryDeletion(t.id,e):confirm(`Tem certeza que deseja excluir o pedido número ${e}?`)&&window.deleteDelivery(t.id)})),e.appendChild(n)}))})),0===n.length){const t=document.createElement("tr");t.innerHTML='\n      <td colspan="4" class="empty-state">\n        Nenhuma entrega registrada\n      </td>\n    ',e.appendChild(t)}}function D(){const e=document.getElementById("gasTableBody");e&&(e.innerHTML="",h.forEach((t=>{const n=document.createElement("tr"),o=ze(t.date)||"Data inválida",a=parseFloat(t.amount)||0,s=document.createTextNode(t.id||"").textContent;n.innerHTML=`\n      <td>${o}</td>\n      <td>R$ ${Oe(a)}</td>\n      <td>\n        <button class="action-button delete" title="Excluir">\n          <i class="fas fa-trash"></i>\n        </button>\n      </td>\n    `;const i=n.querySelector(".action-button.delete");i&&i.addEventListener("click",(()=>{const e=Oe(a);window.confirmGasDeletion?window.confirmGasDeletion(s,e):confirm(`Tem certeza que deseja excluir o abastecimento no valor de R$ ${e}?`)&&window.deleteGasEntry(s)})),e.appendChild(n)})))}function B(e){try{f=f.filter((t=>t.id!==e)),w(),S(),$(),Ge("Entrega excluída com sucesso","success")}catch(t){console.error("Erro ao excluir entrega:",t),Ge("Erro ao excluir entrega","error")}}function k(e){try{h=h.filter((t=>t.id!==e)),b(),D(),$(),Ge("Registro de gasolina excluído com sucesso","success")}catch(t){console.error("Erro ao excluir registro de gasolina:",t),Ge("Erro ao excluir registro de gasolina","error")}}function T(){return p()}function C(e){const t="string"==typeof e?parseFloat(e):e;return isNaN(t)?0:Math.round(100*t)/100}let N={dailyData:null,lastUpdate:0};function P(){N={dailyData:null,lastUpdate:0}}function M(){if(console.time("Renderização de Análises"),0===f.length)return["financialSummary","revenueExpenseChart","expenseDeliveryRatio","expenseIncomeRatio","performanceMetrics","bestDay","worstDay"].forEach((e=>{const t=document.getElementById(e);t&&(t.innerHTML='<p class="empty-state">Nenhum dado cadastrado</p>')})),void console.timeEnd("Renderização de Análises");f.forEach((e=>{e.status||(e.status=parseFloat(e.fee)>0?"completed":"pending")}));const e=[new Promise((e=>{console.time("Renderização do Resumo Financeiro");const t=f.reduce(((e,t)=>e+C(t.fee)),0),n=h.reduce(((e,t)=>e+C(t.amount)),0),o=C(t-n),a=t>0?o/t*100:0,s=f.filter((e=>"pending"===e.status)).length,i=f.filter((e=>"completed"===e.status)).length,r=document.getElementById("financialSummary");if(!r)return console.timeEnd("Renderização do Resumo Financeiro"),void e();r.innerHTML=`\n      <div class="metric-grid">\n        <div class="metric-card">\n          <div class="metric-value">R$ ${Oe(t)}</div>\n          <div class="metric-label">Total em Taxas</div>\n        </div>\n        <div class="metric-card">\n          <div class="metric-value">R$ ${Oe(n)}</div>\n          <div class="metric-label">Total em Gasolina</div>\n        </div>\n        <div class="metric-card">\n          <div class="metric-value ${o>=0?"profit-positive":"profit-negative"}">R$ ${Oe(o)}</div>\n          <div class="metric-label">Lucro Líquido</div>\n        </div>\n        <div class="metric-card">\n          <div class="metric-value ${a>=0?"profit-positive":"profit-negative"}">${a.toFixed(1)}%</div>\n          <div class="metric-label">Margem de Lucro</div>\n        </div>\n        <div class="metric-card orders-summary">\n          <div class="metric-value">\n            <span class="status-badge status-completed" title="Pedidos finalizados">${i}</span>\n            ${s>0?`\n              <span class="status-badge status-pending" title="Pedidos pendentes">${s}</span>\n            `:""}\n          </div>\n          <div class="metric-label">Total de Pedidos</div>\n        </div>\n      </div>\n    `,console.timeEnd("Renderização do Resumo Financeiro"),e()})),new Promise((e=>{console.time("Renderização do Gráfico de Receitas vs Despesas");const t=f.reduce(((e,t)=>e+C(t.fee)),0),n=h.reduce(((e,t)=>e+C(t.amount)),0),o=t+n,a=document.getElementById("revenueExpenseChart");if(!a)return console.timeEnd("Renderização do Gráfico de Receitas vs Despesas"),void e();if(o<=0)return a.innerHTML='\n        <p class="empty-state">Não há dados suficientes para análise de receitas vs despesas</p>\n      ',console.timeEnd("Renderização do Gráfico de Receitas vs Despesas"),void e();const s=t/o*100,i=n/o*100;a.innerHTML=`\n      <div class="chart-container">\n        <div class="pie-chart" style="background-image: conic-gradient(#16a34a 0% ${s}%, #dc2626 ${s}% 100%);">\n        </div>\n        <div class="pie-label">\n          <div class="pie-label-item">\n            <span class="pie-color" style="background-color: #16a34a;"></span>\n            <span>Taxas: ${s.toFixed(1)}% (R$ ${Oe(t)})</span>\n          </div>\n          <div class="pie-label-item">\n            <span class="pie-color" style="background-color: #dc2626;"></span>\n            <span>Gasolina: ${i.toFixed(1)}% (R$ ${Oe(n)})</span>\n          </div>\n        </div>\n      </div>\n    `,console.timeEnd("Renderização do Gráfico de Receitas vs Despesas"),e()})),new Promise((e=>{console.time("Renderização da Relação Gastos/Pedidos");const t=R(),n=Object.entries(t).map((([e,t])=>{const n=t.deliveryCount>0?C(t.gasExpenses/t.deliveryCount):0,o=t.deliveryCount>0?C(t.totalFees/t.deliveryCount):0;return{date:e,ratio:n,deliveryCount:t.deliveryCount,gasExpenses:t.gasExpenses,avgPerDelivery:o,totalFees:t.totalFees}})).sort(((e,t)=>t.date.localeCompare(e.date))).slice(0,7),o=document.getElementById("expenseDeliveryRatio");return o?0===n.length?(o.innerHTML='<p class="empty-state">Não há dados suficientes para análise</p>',console.timeEnd("Renderização da Relação Gastos/Pedidos"),void e()):(o.innerHTML=`\n      <div class="metric-list">\n        ${n.map((({date:e,ratio:t,deliveryCount:n,gasExpenses:o,avgPerDelivery:a,totalFees:s})=>{const i=o>0?C(s/o*100):s>0?400:0,r=i>=300?"high-efficiency":i>=200?"medium-efficiency":"low-efficiency";return`\n            <div class="metric-item ${r}">\n              <div class="metric-header">\n                <div class="metric-date">${ze(e)} (${Fe(e)})</div>\n                <div class="metric-efficiency" title="Eficiência: Ganhos/Gastos">\n                  ${i.toFixed(0)}% eficiência\n                </div>\n              </div>\n              <div class="metric-details">\n                <div class="metric-row">\n                  <span class="metric-label">Gasto por entrega:</span>\n                  <span class="metric-value">R$ ${Oe(t)}</span>\n                </div>\n                <div class="metric-row">\n                  <span class="metric-label">Ganho por entrega:</span>\n                  <span class="metric-value">R$ ${Oe(a)}</span>\n                </div>\n                <div class="metric-row">\n                  <span class="metric-label">Total de entregas:</span>\n                  <span class="metric-value">${n}</span>\n                </div>\n                <div class="metric-row">\n                  <span class="metric-label">Gasto total:</span>\n                  <span class="metric-value">R$ ${Oe(o)}</span>\n                </div>\n                <div class="metric-row">\n                  <span class="metric-label">Ganho total:</span>\n                  <span class="metric-value">R$ ${Oe(s)}</span>\n                </div>\n              </div>\n              <div class="metric-bar-container">\n                <div class="metric-bar" style="width: ${Math.min(i,400)/4}%"></div>\n              </div>\n            </div>\n          `})).join("")}\n      </div>\n    `,console.timeEnd("Renderização da Relação Gastos/Pedidos"),void e()):(console.timeEnd("Renderização da Relação Gastos/Pedidos"),void e())})),new Promise((e=>{console.time("Renderização da Relação Gastos/Ganhos");const t=R(),n=Object.entries(t).map((([e,t])=>{const n=t.totalFees>0?C(t.gasExpenses/t.totalFees*100):t.gasExpenses>0?100:0,o=C(t.totalFees-t.gasExpenses);return{date:e,ratio:n,income:t.totalFees,expenses:t.gasExpenses,profit:o,deliveryCount:t.deliveryCount,pendingCount:t.pendingCount,completedCount:t.completedCount}})).sort(((e,t)=>t.date.localeCompare(e.date))).slice(0,7),o=document.getElementById("expenseIncomeRatio");return o?0===n.length?(o.innerHTML='<p class="empty-state">Não há dados suficientes para análise</p>',console.timeEnd("Renderização da Relação Gastos/Ganhos"),void e()):(o.innerHTML=`\n      <div class="metric-list">\n        ${n.map((({date:e,ratio:t,income:n,expenses:o,profit:a,deliveryCount:s,pendingCount:i,completedCount:r})=>{const c=n>0?a/n*100:0,d=t<=25?"high-efficiency":t<=40?"medium-efficiency":"low-efficiency";return`\n            <div class="metric-item ${d}">\n              <div class="metric-header">\n                <div class="metric-date">${ze(e)} (${Fe(e)})</div>\n                <div class="metric-efficiency" title="Gastos em relação aos ganhos">\n                  ${t.toFixed(1)}% dos ganhos\n                </div>\n              </div>\n              <div class="metric-details">\n                <div class="metric-row">\n                  <span class="metric-label">Status:</span>\n                  <span class="metric-value">\n                    <span class="status-badge status-completed" title="Pedidos finalizados">${r}</span>\n                    ${i>0?`\n                      <span class="status-badge status-pending" title="Pedidos pendentes">${i}</span>\n                    `:""}\n                  </span>\n                </div>\n                <div class="metric-row">\n                  <span class="metric-label">Ganhos:</span>\n                  <span class="metric-value">R$ ${Oe(n)}</span>\n                </div>\n                <div class="metric-row">\n                  <span class="metric-label">Gastos:</span>\n                  <span class="metric-value">R$ ${Oe(o)}</span>\n                </div>\n                <div class="metric-row">\n                  <span class="metric-label">Lucro:</span>\n                  <span class="metric-value ${a>=0?"profit-positive":"profit-negative"}">\n                    R$ ${Oe(a)}\n                  </span>\n                </div>\n                <div class="metric-row">\n                  <span class="metric-label">Margem de Lucro:</span>\n                  <span class="metric-value ${c>=0?"profit-positive":"profit-negative"}">\n                    ${c.toFixed(1)}%\n                  </span>\n                </div>\n                <div class="metric-row">\n                  <span class="metric-label">Total de Entregas:</span>\n                  <span class="metric-value">${s}</span>\n                </div>\n              </div>\n              <div class="metric-bar-container" title="Proporção Gastos/Ganhos">\n                <div class="metric-bar" style="width: ${Math.min(t,100)}%"></div>\n              </div>\n            </div>\n          `})).join("")}\n      </div>\n    `,console.timeEnd("Renderização da Relação Gastos/Ganhos"),void e()):(console.timeEnd("Renderização da Relação Gastos/Ganhos"),void e())})),new Promise((e=>{console.time("Renderização das Métricas de Desempenho");const t=R(),n=Object.values(t);if(0===n.length){const t=document.getElementById("performanceMetrics");return t&&(t.innerHTML='<p class="empty-state">Não há dados suficientes para análise</p>'),console.timeEnd("Renderização das Métricas de Desempenho"),void e()}const o=n.length>0?n.reduce(((e,t)=>e+t.deliveryCount),0)/n.length:0,a=f.length>0?C(f.reduce(((e,t)=>e+C(t.fee)),0)/f.length):0,s=n.length>0?C(n.reduce(((e,t)=>e+t.gasExpenses),0)/n.length):0,i=document.getElementById("performanceMetrics");if(!i)return console.timeEnd("Renderização das Métricas de Desempenho"),void e();i.innerHTML=`\n      <div class="metric-grid">\n        <div class="metric-card">\n          <div class="metric-value">${o.toFixed(1)}</div>\n          <div class="metric-label">Média de Entregas/Dia</div>\n        </div>\n        <div class="metric-card">\n          <div class="metric-value">R$ ${Oe(a)}</div>\n          <div class="metric-label">Média por Entrega</div>\n        </div>\n        <div class="metric-card">\n          <div class="metric-value">R$ ${Oe(s)}</div>\n          <div class="metric-label">Média Gasto/Dia</div>\n        </div>\n      </div>\n    `,console.timeEnd("Renderização das Métricas de Desempenho"),e()})),new Promise((e=>{console.time("Renderização do Melhor Dia");const t=R();if(0===Object.keys(t).length){const t=document.getElementById("bestDay");return t&&(t.innerHTML='<p class="empty-state">Não há dados suficientes para análise</p>'),console.timeEnd("Renderização do Melhor Dia"),void e()}const n=Object.entries(t).map((([e,t])=>({date:e,profit:t.totalFees-t.gasExpenses,deliveryCount:t.deliveryCount,totalFees:t.totalFees,gasExpenses:t.gasExpenses}))).sort(((e,t)=>{const n=t.profit-e.profit;return 0!==n?n:t.deliveryCount-e.deliveryCount}))[0];if(!n)return console.timeEnd("Renderização do Melhor Dia"),void e();const o=document.getElementById("bestDay");if(!o)return console.timeEnd("Renderização do Melhor Dia"),void e();o.innerHTML=`\n      <div class="best-day-container">\n        <div class="day-header">${ze(n.date)} (${Fe(n.date)})</div>\n        <div class="metric-grid">\n          <div class="metric-card">\n            <div class="metric-value ${n.profit>=0?"profit-positive":"profit-negative"}">\n              R$ ${Oe(n.profit)}\n            </div>\n            <div class="metric-label">Lucro</div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-value">${n.deliveryCount}</div>\n            <div class="metric-label">Entregas</div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-value">R$ ${Oe(n.totalFees)}</div>\n            <div class="metric-label">Ganhos</div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-value">R$ ${Oe(n.gasExpenses)}</div>\n            <div class="metric-label">Gastos</div>\n          </div>\n        </div>\n      </div>\n    `,console.timeEnd("Renderização do Melhor Dia"),e()})),new Promise((e=>{console.time("Renderização do Pior Dia");const t=R();if(0===Object.keys(t).length){const t=document.getElementById("worstDay");return t&&(t.innerHTML='<p class="empty-state">Não há dados suficientes para análise</p>'),console.timeEnd("Renderização do Pior Dia"),void e()}const n=Object.entries(t).map((([e,t])=>({date:e,profit:t.totalFees-t.gasExpenses,deliveryCount:t.deliveryCount,totalFees:t.totalFees,gasExpenses:t.gasExpenses,avgPerDelivery:t.deliveryCount>0?t.totalFees/t.deliveryCount:0}))).sort(((e,t)=>{const n=e.profit-t.profit;return 0!==n?n:e.avgPerDelivery-t.avgPerDelivery}))[0];if(!n)return console.timeEnd("Renderização do Pior Dia"),void e();const o=document.getElementById("worstDay");if(!o)return console.timeEnd("Renderização do Pior Dia"),void e();o.innerHTML=`\n      <div class="worst-day-container">\n        <div class="day-header">${ze(n.date)} (${Fe(n.date)})</div>\n        <div class="metric-grid">\n          <div class="metric-card">\n            <div class="metric-value ${n.profit>=0?"profit-positive":"profit-negative"}">\n              R$ ${Oe(n.profit)}\n            </div>\n            <div class="metric-label">Lucro</div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-value">${n.deliveryCount}</div>\n            <div class="metric-label">Entregas</div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-value">R$ ${Oe(n.totalFees)}</div>\n            <div class="metric-label">Ganhos</div>\n          </div>\n          <div class="metric-card">\n            <div class="metric-value">R$ ${Oe(n.gasExpenses)}</div>\n            <div class="metric-label">Gastos</div>\n          </div>\n        </div>\n        <div class="metric-details">\n          <div>Média por entrega: R$ ${Oe(n.avgPerDelivery)}</div>\n        </div>\n      </div>\n    `,console.timeEnd("Renderização do Pior Dia"),e()}))];Promise.all(e).then((()=>{document.querySelectorAll(".chart-container").forEach((e=>{var t;(t=e)&&Z()&&(t.querySelectorAll(".pie-chart, .bar-chart, .line-chart").forEach((e=>{e.style.willChange="transform",e.style.transform="translateZ(0)"})),t.querySelectorAll(".bar-value, .pie-label").forEach((e=>{e.style.zIndex="2"}))),function(e){if(e&&Z()){e.querySelector(".bar-chart, .line-chart")&&(e.style.overflowX="auto",e.style.webkitOverflowScrolling="touch");const t=e.querySelector(".pie-label");t&&(t.style.flexDirection="column",t.style.alignItems="center",t.style.marginTop="45px")}}(e)})),console.timeEnd("Renderização de Análises")}))}function R(){const e=Date.now()-N.lastUpdate;if(N.dailyData&&e<5e3)return N.dailyData;console.time("Agrupamento de Dados");const t={};return f.forEach((e=>{const n=e.date;t[n]||(t[n]={deliveries:[],totalFees:0,gasExpenses:0,deliveryCount:0,pendingCount:0,completedCount:0}),t[n].deliveries.push(e),"pending"===e.status?t[n].pendingCount+=1:"completed"===e.status&&(t[n].completedCount+=1,t[n].totalFees+=C(e.fee)),t[n].deliveryCount+=1})),h.forEach((e=>{const n=e.date;t[n]||(t[n]={deliveries:[],totalFees:0,gasExpenses:0,deliveryCount:0,pendingCount:0,completedCount:0}),t[n].gasExpenses+=C(e.amount)})),N.dailyData=t,N.lastUpdate=Date.now(),console.timeEnd("Agrupamento de Dados"),t}function z(e,t){const n=[];return e.date||n.push(`Data inválida para ${t}`),e.id||n.push(`ID inválido para ${t}`),"Entrega"===t?(e.orderNumber||n.push("Número do pedido inválido"),"number"!=typeof e.fee&&""!==e.fee&&n.push("Taxa de entrega inválida")):"Gasolina"===t&&"number"!=typeof e.amount&&""!==e.amount&&n.push("Valor da gasolina inválido"),n}function A(e){const t=()=>{e&&e.target&&(e.target.value="")},n=e.target?e.target.files[0]:e.file||null;if(!n)return t(),void Ge("Nenhum arquivo selecionado","error");if(!function(e){return e.name.toLowerCase().endsWith(".csv")||["text/csv","text/comma-separated-values","application/csv","application/excel","application/vnd.ms-excel","application/vnd.msexcel","text/anytext","text/plain"].includes(e.type)}(n))return t(),void Ge("Por favor, selecione um arquivo CSV válido","error");const o=Ge("Processando arquivo...","info",0),a=new FileReader;a.onload=function(e){try{o&&document.body.removeChild(o);const t=e.target.result;if(!t||!t.trim())throw new Error("O arquivo está vazio");const n=t.split("\n")[0];let a=",";n.includes(";")?a=";":n.includes("\t")&&(a="\t");const s=t.split("\n").filter((e=>e.trim())),i=["Data","Tipo","ID","Número do Pedido","Valor Pedido","Valor Gasolina","Status","Imagem"],r=s[0].split(a).map((e=>e.trim())),c=i.filter((e=>!r.includes(e)));if(c.length>0)throw new Error(`Cabeçalhos ausentes no CSV: ${c.join(", ")}`);const d=[],l=[],m=[];for(let e=1;e<s.length;e++){if(!s[e].trim())continue;const t=[];let n="",o=!1;for(let r of s[e])'"'===r?o=!o:r!==a||o?n+=r:(t.push(n),n="");t.push(n);const i={};if(r.forEach(((e,n)=>{var o;i[e]=(null==(o=t[n])?void 0:o.trim())||""})),"Gasolina"===i.Tipo){const t={id:i.ID||String(Date.now()),date:Ae(qe(i.Data)),amount:parseFloat(i["Valor Gasolina"])||0,image:i.Imagem||null},n=z(t,"Gasolina");n.length>0?m.push(`Linha ${e+1} (Gasolina): ${n.join(", ")}`):l.push(t)}else{const t={id:i.ID||String(Date.now()),date:Ae(qe(i.Data)),orderNumber:i["Número do Pedido"],fee:parseFloat(i["Valor Pedido"])||0,image:i.Imagem||null},n=z(t,"Entrega");n.length>0?m.push(`Linha ${e+1} (Entrega): ${n.join(", ")}`):d.push(t)}}if(m.length>0)throw new Error(`Erros na importação:\n${m.join("\n")}`);if(0===d.length&&0===l.length)throw new Error("Nenhum dado válido encontrado para importação");localStorage.setItem("deliveries",JSON.stringify(d)),localStorage.setItem("gasEntries",JSON.stringify(l)),I(),x(),$(),Ge(`Importação concluída: ${d.length} entregas e ${l.length} abastecimentos`,"success")}catch(n){console.error("Erro na importação:",n),Ge(n.message,"error")}t()},a.onerror=function(){Ge("Erro ao ler o arquivo","error"),t()},a.readAsText(n)}function O(e,t,n){const o=function(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return Math.abs(t)}(`${`${String(e.getDate()).padStart(2,"0")}${String(e.getMonth()+1).padStart(2,"0")}${e.getFullYear()}`}-${t.toFixed(2)}-${n.toFixed(2)}`);return String(o%1e5).padStart(5,"0")}function F(e){const t=e.toISOString().split("T")[0],n=f.filter((e=>e.date===t)).sort(((e,t)=>new Date(e.date)-new Date(t.date))),o=n.length>0&&parseFloat(n[0].fee)||0,a=n.length>0&&parseFloat(n[n.length-1].fee)||0,s=O(e,o,a),i=function(e,t){return`${String(e.getDate()).padStart(2,"0")}-${String(e.getMonth()+1).padStart(2,"0")}-${t}`}(e,s);return{id:s,fileName:i,firstOrderValue:o,lastOrderValue:a}}function q(e,t){const n=[];return e.forEach(((e,o)=>{e.date||n.push(`${t} #${o+1}: Data inválida`),e.id||n.push(`${t} #${o+1}: ID inválido`),"Entrega"===t?(e.orderNumber||n.push(`Entrega #${o+1}: Número do pedido inválido`),"number"!=typeof e.fee&&""!==e.fee&&n.push(`Entrega #${o+1}: Taxa inválida`)):"Gasolina"===t&&"number"!=typeof e.amount&&""!==e.amount&&n.push(`Gasolina #${o+1}: Valor inválido`)})),n}function G(e=!0){const t=[...q(f,"Entrega"),...e?q(h,"Gasolina"):[]];if(t.length>0)throw new Error(`Erros nos dados:\n${t.join("\n")}`);const n=[];return f.forEach((e=>{n.push([ze(e.date),"Entrega",e.id,e.orderNumber,e.fee,"",e.fee?"concluido":"pendente",e.image||""])})),e&&h.forEach((e=>{n.push([ze(e.date),"Gasolina",e.id,"","",e.amount,"Pago",e.image||""])})),[["Data","Tipo","ID","Número do Pedido","Valor Pedido","Valor Gasolina","Status","Imagem"].join(","),...n.map((e=>e.map((e=>"string"==typeof e&&(e.includes(",")||e.includes("\n")||e.includes('"'))?`"${e.replace(/"/g,'""')}"`:e)).join(",")))].join("\n")}function j(){if(confirm("Tem certeza que deseja limpar todos os dados? Esta ação não pode ser desfeita."))try{_(),Ge("Todos os dados foram limpos com sucesso!","success")}catch(e){console.error("Erro ao limpar dados:",e),Ge(e.message,"error")}}function _(){localStorage.clear(),sessionStorage.clear(),f.length=0,h.length=0,P();try{const e=new BroadcastChannel("entrega_financeira_sync");e.postMessage({type:"FULL_CLEAR",timestamp:Date.now()}),e.close()}catch(e){console.log("BroadcastChannel não disponível para limpeza")}document.querySelectorAll('img[src^="blob:"]').forEach((e=>{e.src.startsWith("blob:")&&URL.revokeObjectURL(e.src)})),I(),x(),$(),p()}function H(){if(confirm("Tem certeza que deseja finalizar a semana? Isso irá exportar e limpar todos os dados."))try{let t=function(e){const t=URL.createObjectURL(i),n=document.createElement("a");n.href=t,n.download=a,n.style.display="none",document.body.appendChild(n),n.click(),setTimeout((()=>{document.body.removeChild(n),URL.revokeObjectURL(t),e&&c()}),300)};if(0===f.length&&0===h.length)throw new Error("Não há dados para exportar");const n=new Date,{fileName:o}=F(n),a=`relatorio-${o}.csv`,s=G(!0),i=new Blob([s],{type:"text/csv;charset=utf-8;"}),r=window.innerWidth<=768||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),c=()=>{_(),Ge("Semana finalizada com sucesso!","success")};if(r)try{if(navigator.share&&/iPhone|iPad|iPod/i.test(navigator.userAgent)){const e=new File([i],a,{type:"text/csv"});navigator.share({files:[e],title:"Exportação de dados semanal",text:"Relatório semanal do Sistema de Entregas"}).then((()=>{c()})).catch((e=>{console.error("Erro ao compartilhar arquivo:",e),t(!0)}))}else t(!0)}catch(e){console.error("Erro específico para mobile:",e),t(!0)}else t(!0)}catch(e){console.error("Erro ao finalizar semana:",e),Ge(e.message,"error")}}function U(e=!0){const t=[...q(f,"Entrega"),...e?q(h,"Gasolina"):[]];if(t.length>0)throw new Error(`Erros nos dados:\n${t.join("\n")}`);const n=[];return f.forEach((e=>{n.push([ze(e.date),"Entrega",e.id,e.orderNumber,e.fee,"",e.fee?"concluido":"pendente"])})),e&&h.forEach((e=>{n.push([ze(e.date),"Gasolina",e.id,"","",e.amount,"Pago"])})),[["Data","Tipo","ID","Número do Pedido","Valor Pedido","Valor Gasolina","Status"].join(","),...n.map((e=>e.map((e=>"string"==typeof e&&(e.includes(",")||e.includes("\n")||e.includes('"'))?`"${e.replace(/"/g,'""')}"`:e)).join(",")))].join("\n")}function V(){const e=document.getElementById("exportModal");if(!e)return void console.error("Modal de exportação não encontrado");e.style.display="flex",document.getElementById("exportDeliveries"),document.getElementById("exportGas"),document.getElementById("exportImages");const t=document.getElementById("exportDeliveriesGroup"),n=document.getElementById("exportGasGroup"),o=document.getElementById("exportImagesGroup"),a=t.cloneNode(!0),s=n.cloneNode(!0),i=o.cloneNode(!0);t.parentNode.replaceChild(a,t),n.parentNode.replaceChild(s,n),o.parentNode.replaceChild(i,o);const r=document.getElementById("exportDeliveries"),c=document.getElementById("exportGas"),d=document.getElementById("exportImages");a.addEventListener("click",(e=>{e.target!==r&&(r.checked=!r.checked)})),s.addEventListener("click",(e=>{e.target!==c&&(c.checked=!c.checked)})),i.addEventListener("click",(e=>{e.target!==d&&(d.checked=!d.checked)}));[a,s,i].forEach((e=>{e.style.cursor="pointer",e.style.padding="12px 8px",e.style.margin="8px 0",e.style.borderRadius="4px",e.style.border="1px solid #e0e0e0",e.style.transition="background-color 0.2s",e.addEventListener("mouseover",(()=>{e.style.backgroundColor="#f5f5f5"})),e.addEventListener("mouseout",(()=>{e.style.backgroundColor=""}))}));const l=document.getElementById("cancelExport"),m=document.getElementById("confirmExport"),u=document.getElementById("exportOnlyImages"),g=l.cloneNode(!0),p=m.cloneNode(!0),v=u.cloneNode(!0);l.parentNode.replaceChild(g,l),m.parentNode.replaceChild(p,m),u.parentNode.replaceChild(v,u),g.addEventListener("click",(()=>{e.style.display="none"})),p.addEventListener("click",(()=>{const t=document.getElementById("exportDeliveries").checked,n=document.getElementById("exportGas").checked,o=document.getElementById("exportImages").checked;t||n?(W(t,n,o),e.style.display="none"):Ge("Selecione pelo menos um tipo de dado para exportar","error")})),v.addEventListener("click",(async()=>{try{e.style.display="none",Q()}catch(t){console.error("Erro ao abrir modal de exportação de imagens:",t),Ge(t.message,"error")}}));e.querySelector(".edit-modal").addEventListener("click",(e=>{e.stopPropagation()})),e.addEventListener("click",(()=>{e.style.display="none"}))}function W(e=!0,t=!0,n=!0){try{let a=function(){const e=URL.createObjectURL(v),t=document.createElement("a");t.href=e,t.download=g,t.style.display="none",document.body.appendChild(t),t.click(),setTimeout((()=>{document.body.removeChild(t),URL.revokeObjectURL(e)}),100)},s=[...f],i=[...h];if(!(e&&0!==s.length||t&&0!==i.length))throw new Error("Não há dados para exportar");let r=["Data","Tipo","ID","Número do Pedido","Valor Pedido"];t&&r.push("Valor Gasolina"),r.push("Status"),n&&r.push("Imagem");const c=[];e&&s.forEach((e=>{const o=[ze(e.date),"Entrega",e.id,e.orderNumber,e.fee];t&&o.push(""),o.push(e.fee?"concluido":"pendente"),n&&o.push(e.image||""),c.push(o)})),t&&i.forEach((e=>{const o=[ze(e.date),"Gasolina",e.id,"",""];t&&o.push(e.amount),o.push("Pago"),n&&o.push(e.image||""),c.push(o)}));const d=[r.join(","),...c.map((e=>e.map((e=>"string"==typeof e&&(e.includes(",")||e.includes("\n")||e.includes('"'))?`"${e.replace(/"/g,'""')}"`:e)).join(",")))].join("\n"),l=new Date,{fileName:m}=F(l);let u="";e||(u+="-no-delivery"),t||(u+="-no-gas"),n||(u+="-no-images");const g=`exportacao${u}-${m}.csv`,p=window.innerWidth<=768||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),v=new Blob([d],{type:"text/csv;charset=utf-8;"});if(p)try{if(navigator.share&&/iPhone|iPad|iPod/i.test(navigator.userAgent)){const e=new File([v],g,{type:"text/csv"});navigator.share({files:[e],title:"Exportação de dados",text:"Dados exportados do Sistema de Entregas"}).then((()=>{Ge("Exportação concluída com sucesso!","success")})).catch((e=>{console.error("Erro ao compartilhar arquivo:",e),a()}))}else a()}catch(o){console.error("Erro específico para mobile:",o),a()}else a();n&&le();Ge(`Exportação concluída com sucesso! ${(e?s.length:0)+(t?i.length:0)} registros exportados.`,"success")}catch(o){console.error("Erro ao exportar dados:",o),Ge(o.message,"error")}}async function J(e=!0,t=!0){try{"function"!=typeof JSZip&&await new Promise(((e,t)=>{if("function"==typeof JSZip)return void e();const n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js",n.integrity="sha512-XMVd28F1oH/O71fzwBnV7HucLxVwtxf26XV8P4wPk26EDxuGZ91N8bsOttmnomcCD3CS5ZMRL50H0GgOHvegtg==",n.crossOrigin="anonymous",n.onload=()=>{e()},n.onerror=()=>{t(new Error("Falha ao carregar biblioteca JSZip"))},document.head.appendChild(n)}));const o=new JSZip;let a=0;if(e&&f.forEach((e=>{if(e.image){const t=e.image.startsWith("data:")?e.image.split(",")[1]:e.image,n=`pedido_${e.orderNumber}_${e.date}.jpg`;o.file(n,t,{base64:!0}),a++}})),t&&h.forEach(((e,t)=>{if(e.image){const n=e.image.startsWith("data:")?e.image.split(",")[1]:e.image,s=`gasolina_${e.date}_${t+1}.jpg`;o.file(s,n,{base64:!0}),a++}})),0===a)throw new Error("Não há imagens para exportar");const s=new Date,{fileName:i}=F(s);let r="";e||(r+="-no-delivery"),t||(r+="-no-gas");const c=`imagens${r}-${i}.zip`,d=await o.generateAsync({type:"blob"});if(window.innerWidth<=768||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))try{if(navigator.share&&/iPhone|iPad|iPod/i.test(navigator.userAgent)){const e=new File([d],c,{type:"application/zip"});navigator.share({files:[e],title:"Imagens Exportadas",text:"Imagens exportadas do Sistema de Entregas"}).then((()=>{Ge(`Exportação de imagens concluída! ${a} imagens exportadas.`,"success")})).catch((e=>{console.error("Erro ao compartilhar arquivo:",e),Y(d,c)}))}else Y(d,c)}catch(n){console.error("Erro específico para mobile:",n),Y(d,c)}else Y(d,c);Ge(`Exportação de imagens concluída! ${a} imagens exportadas.`,"success")}catch(n){console.error("Erro ao exportar imagens:",n),Ge(n.message,"error")}}function Y(e,t){const n=URL.createObjectURL(e),o=document.createElement("a");o.href=n,o.download=t,o.style.display="none",document.body.appendChild(o),o.click(),setTimeout((()=>{document.body.removeChild(o),URL.revokeObjectURL(n)}),100)}function Q(){const e=document.getElementById("imagesExportModal");if(!e)return void console.error("Modal de exportação de imagens não encontrado");e.style.display="flex",document.getElementById("exportDeliveryImages"),document.getElementById("exportGasImages");const t=document.getElementById("exportDeliveryImagesGroup"),n=document.getElementById("exportGasImagesGroup"),o=t.cloneNode(!0),a=n.cloneNode(!0);t.parentNode.replaceChild(o,t),n.parentNode.replaceChild(a,n);const s=document.getElementById("exportDeliveryImages"),i=document.getElementById("exportGasImages");o.addEventListener("click",(e=>{e.target!==s&&(s.checked=!s.checked)})),a.addEventListener("click",(e=>{e.target!==i&&(i.checked=!i.checked)}));[o,a].forEach((e=>{e.style.cursor="pointer",e.style.padding="12px 8px",e.style.margin="8px 0",e.style.borderRadius="4px",e.style.border="1px solid #e0e0e0",e.style.transition="background-color 0.2s",e.addEventListener("mouseover",(()=>{e.style.backgroundColor="#f5f5f5"})),e.addEventListener("mouseout",(()=>{e.style.backgroundColor=""}))}));const r=document.getElementById("cancelImagesExport"),c=document.getElementById("confirmImagesExport"),d=r.cloneNode(!0),l=c.cloneNode(!0);r.parentNode.replaceChild(d,r),c.parentNode.replaceChild(l,c),d.addEventListener("click",(()=>{e.style.display="none"})),l.addEventListener("click",(async()=>{try{const t=document.getElementById("exportDeliveryImages").checked,n=document.getElementById("exportGasImages").checked;if(!t&&!n)return void Ge("Selecione pelo menos um tipo de imagem para exportar","error");e.style.display="none",Ge("Preparando imagens para exportação...","info"),await J(t,n)}catch(t){console.error("Erro ao exportar imagens:",t),Ge(t.message,"error")}}));e.querySelector(".edit-modal").addEventListener("click",(e=>{e.stopPropagation()})),e.addEventListener("click",(()=>{e.style.display="none"}))}const X=Object.freeze(Object.defineProperty({__proto__:null,backupData:function(e=!0){try{if(0===f.length&&(!e||0===h.length))throw new Error("Não há dados para exportar");const t=new Date,{fileName:n}=F(t),o=G(e),a=new Blob([o],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(a),i=document.createElement("a");i.href=s,i.download=`backup-${n}${e?"":"-no-gas"}.csv`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s),le();Ge(`Backup realizado com sucesso! ${f.length+(e?h.length:0)} registros exportados.`,"success")}catch(t){console.error("Erro ao fazer backup:",t),Ge(t.message,"error")}},backupNoImagesCSV:function(e=!0){try{if(0===f.length&&(!e||0===h.length))throw new Error("Não há dados para exportar");const t=new Date,{fileName:n}=F(t),o=U(e),a=new Blob([o],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(a),i=document.createElement("a");i.href=s,i.download=`backup-sem-imagens-${n}.csv`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s);Ge(`Backup sem imagens realizado com sucesso! ${f.length+(e?h.length:0)} registros exportados.`,"success")}catch(t){console.error("Erro ao fazer backup sem imagens:",t),Ge(t.message,"error")}},clearAllData:j,exportCustomCSV:W,exportOnlyImages:J,finishWeek:H,generateCSV:G,generateCSVNoImages:U,showExportModal:V,showImagesExportModal:Q},Symbol.toStringTag,{value:"Module"}));function Z(){return window.innerWidth<=768||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function K(){try{document.querySelectorAll('img[src^="blob:"]').forEach((e=>{e.src.startsWith("blob:")&&URL.revokeObjectURL(e.src)}));if(document.querySelectorAll("canvas").forEach((e=>{document.body.contains(e)||(e.width=0,e.height=0)})),window.gc)try{window.gc()}catch(e){console.log("Garbage collection not available")}return!0}catch(t){return console.error("Error cleaning up resources:",t),!1}}function ee(){document.querySelectorAll('input[type="file"]').forEach((e=>{e.addEventListener("focus",(()=>{K()}))}))}function te(){oe(),Z()&&(window.navigator.deviceMemory&&window.navigator.deviceMemory<4&&document.documentElement.classList.add("reduce-motion"),function(){let e;document.addEventListener("scroll",(()=>{clearTimeout(e),document.body.classList.add("is-scrolling"),e=setTimeout((()=>{document.body.classList.remove("is-scrolling")}),150)}),{passive:!0})}(),function(){const e=()=>{document.documentElement.style.setProperty("--app-height",`${window.innerHeight}px`)};window.addEventListener("resize",e),e()}(),ne()),ee(),document.querySelectorAll('input[type="file"]').forEach((e=>{e.removeAttribute("capture"),e.accept&&e.accept.includes("image")&&(e.accept="image/jpeg,image/png,image/webp,image/*;capture=camera")})),ae()}function ne(){const e=document.getElementById("importButton"),t=document.getElementById("csvInput");if(e&&t){t.accept=".csv,text/csv,text/comma-separated-values,application/csv,application/excel,application/vnd.ms-excel,application/vnd.msexcel,text/anytext,text/plain",t.removeAttribute("capture"),t.setAttribute("multiple","false");const n=e.cloneNode(!0);e.parentNode.replaceChild(n,e);const o=t.cloneNode(!0);t.parentNode.replaceChild(o,t),n.addEventListener("click",(()=>{K()}));const a=()=>{const e=document.getElementById("fileSelectionModal");e&&document.body.removeChild(e);const t=document.createElement("div");t.id="fileSelectionModal",t.className="modal-overlay",t.style.display="flex",t.innerHTML='\n        <div class="edit-modal">\n          <h2>Selecionar Arquivo</h2>\n          <div class="file-selection-container">\n            <p>Selecione um arquivo CSV para importar:</p>\n            <div class="file-input-wrapper">\n              <input type="file" id="mobileFileInput" accept=".csv,text/csv,text/comma-separated-values,application/csv,application/excel,application/vnd.ms-excel,application/vnd.msexcel,text/anytext,text/plain" class="mobile-file-input">\n              <label for="mobileFileInput" class="file-select-button">\n                <i class="fas fa-file-upload"></i>\n                Selecionar arquivo\n              </label>\n            </div>\n            <div id="selectedFileName" class="selected-file-name"></div>\n          </div>\n          <div class="modal-actions">\n            <button type="button" class="btn-cancel" id="cancelFileSelection">Cancelar</button>\n            <button type="button" class="btn-update" id="confirmFileSelection" disabled>Importar</button>\n          </div>\n        </div>\n      ',document.body.appendChild(t);const n=document.getElementById("mobileFileInput"),o=document.getElementById("selectedFileName"),a=document.getElementById("confirmFileSelection"),s=document.getElementById("cancelFileSelection");n.addEventListener("change",(e=>{if(e.target.files&&e.target.files.length>0){const a=document.querySelector(".file-input-wrapper");a&&(a.style.display="none"),o.textContent=e.target.files[0].name,alert(`Arquivo "${e.target.files[0].name}" selecionado para importação`),setTimeout((()=>{try{A({target:n,file:n.files[0]}),t.style.display="none",setTimeout((()=>{document.body.contains(t)&&document.body.removeChild(t)}),300)}catch(e){console.error("Erro ao importar arquivo:",e),Ge("Erro ao importar arquivo. Tente novamente.","error")}}),500)}else o.textContent="",a.disabled=!0})),n.addEventListener("focus",(()=>{K()})),a.style.display="none";const i=document.querySelector(".file-input-wrapper");i&&i.addEventListener("click",(e=>{e.stopPropagation(),K(),n&&(n.focus(),n.click())})),s.addEventListener("click",(()=>{t.style.display="none",setTimeout((()=>{document.body.contains(t)&&document.body.removeChild(t)}),300)})),t.addEventListener("click",(e=>{e.target===t&&(t.style.display="none",setTimeout((()=>{document.body.contains(t)&&document.body.removeChild(t)}),300))}))};n.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),Z()?a():o.click()})),o.addEventListener("change",(e=>{e.target.files&&e.target.files.length>0&&A(e)}))}const n=document.getElementById("finishWeekButton");if(n){const e=n.onclick;n.onclick=t=>{Z()?(t.preventDefault(),confirm("Tem certeza que deseja finalizar a semana? Isso irá exportar e limpar todos os dados.")&&V()):e&&e.call(n,t)}}const o=document.getElementById("exportModal"),a=document.getElementById("confirmExport"),s=document.getElementById("cancelExport");a&&(a.onclick=function(){try{const e=document.getElementById("exportDeliveries").checked,t=document.getElementById("exportGas").checked;W(e,t,document.getElementById("exportImages").checked),o.style.display="none"}catch(e){console.error("Error exporting on mobile:",e)}}),s&&(s.onclick=function(){o.style.display="none"})}function oe(){let e;window.addEventListener("resize",(()=>{clearTimeout(e),document.body.classList.add("resize-transition-stopper"),e=setTimeout((()=>{document.body.classList.remove("resize-transition-stopper"),document.querySelector(".tab-content.active#analytics")&&("function"==typeof clearDataCache&&clearDataCache(),M())}),250)}))}function ae(){const e=()=>{document.querySelectorAll(".pie-chart, .bar-chart, .line-chart, .summary-container").forEach((e=>{e.style.willChange="transform",e.style.transform="translateZ(0)",Z()&&e.setAttribute("loading","lazy")}))};"complete"===document.readyState?e():window.addEventListener("load",e);document.querySelectorAll(".tab-button").forEach((t=>{t.addEventListener("click",(()=>{"analytics"===t.dataset.tab&&setTimeout(e,100)}))}))}function se(){oe(),function(){let e;window.addEventListener("scroll",(()=>{const t=document.querySelector(".analytics-dashboard");t&&(t.classList.add("is-scrolling"),clearTimeout(e),e=setTimeout((()=>{t.classList.remove("is-scrolling")}),150))}),{passive:!0})}(),document.addEventListener("click",(e=>{if(Z()){const t=e.target.closest(".analytics-card");if(t){const e=t.classList.contains("active-card");document.querySelectorAll(".analytics-card").forEach((e=>{e.classList.remove("active-card")})),e||t.classList.add("active-card")}}})),ae(),Z()&&document.addEventListener("touchstart",(function(){}),{passive:!0}),Z()&&ne()}function ie(e,t=800,n=.7){return new Promise(((o,a)=>{const s=URL.createObjectURL(e),i=new Image;i.onerror=()=>{URL.revokeObjectURL(s),a(new Error("Falha ao carregar a imagem"))},i.onload=()=>{try{const e=document.createElement("canvas");let r=i.width,c=i.height;r>t&&(c=Math.floor(c*(t/r)),r=t),e.width=r,e.height=c;e.getContext("2d").drawImage(i,0,0,r,c),e.toBlob((t=>{if(URL.revokeObjectURL(s),t){const n=new FileReader;n.onloadend=()=>{n.result?(e.width=0,e.height=0,o(n.result)):a(new Error("Resultado da compressão da imagem é inválido"))},n.onerror=e=>{a(new Error(`Erro ao ler blob comprimido: ${e.message}`))},n.readAsDataURL(t)}else a(new Error("Falha na compressão da imagem - blob nulo"))}),"image/jpeg",n)}catch(e){URL.revokeObjectURL(s),a(new Error(`Erro ao processar imagem: ${e.message}`))}},i.src=s}))}const re=new Set;async function ce(e){if(!e)return null;const t=Date.now().toString()+Math.random().toString(36).substr(2,9);re.add(t);try{if(window.gc)try{window.gc()}catch(n){console.log("GC not available")}if(!["image/jpeg","image/png","image/webp"].includes(e.type))throw new Error("Tipo de arquivo não suportado. Use JPG, PNG ou WebP.");const a=5242880;e.size>a&&Ge("Comprimindo imagem...","info");const s=Z();let i=s?.5:.7,r=s?600:1e3;if(e.size>3145728&&(i=s?.3:.5,r=s?500:700),s&&e.size>2097152){let n=null;try{if(n=await ie(e,.8*r,i),!re.has(t))return null;const o=await fetch(n),a=await o.blob();a.size>1048576&&(n=await ie(new File([a],e.name,{type:"image/jpeg"}),.7*r,.9*i))}catch(o){console.warn("Multi-step compression failed, falling back to standard compression",o)}if(n)return n}if(!re.has(t))return console.log("Operation cancelled - newer operation started"),null;const c=await ie(e,r,i);if(!c)throw new Error("Falha ao processar a imagem. Tente novamente.");return de(),c}catch(a){throw console.error("Erro ao processar imagem:",a),"QuotaExceededError"===a.name?new Error("Armazenamento do dispositivo está cheio. Faça backup e limpe seus dados."):"NotReadableError"===a.name?new Error("Não foi possível ler a imagem. Tente outra foto."):a.message.includes("tipo de arquivo")?new Error(a.message):Z()?new Error("Erro ao processar a imagem. Tente uma foto menor ou use outro app de câmera."):new Error("Erro ao processar a imagem. "+a.message)}finally{re.delete(t),de()}}function de(){document.querySelectorAll('img[src^="blob:"]').forEach((e=>{e.src.startsWith("blob:")&&URL.revokeObjectURL(e.src)}));if(document.querySelectorAll("canvas").forEach((e=>{document.body.contains(e)||(e.width=0,e.height=0)})),window.gc)try{window.gc()}catch(e){}}function le(){try{const e=JSON.parse(localStorage.getItem("deliveries")||"[]");if(e&&e.length){let t=!1;const n=e.map((e=>{if(e.image&&e.image.length>1e5){const n={...e};return n.image.startsWith("data:image")&&(n.image=n.image.replace(/^data:image\/\w+;base64,/,""),t=!0),n}return e}));t&&localStorage.setItem("deliveries",JSON.stringify(n))}const t=JSON.parse(localStorage.getItem("gasEntries")||"[]");if(t&&t.length){let e=!1;const n=t.map((t=>{if(t.image&&t.image.length>1e5){const n={...t};return n.image.startsWith("data:image")&&(n.image=n.image.replace(/^data:image\/\w+;base64,/,""),e=!0),n}return t}));e&&localStorage.setItem("gasEntries",JSON.stringify(n))}return!0}catch(e){return console.error("Erro ao otimizar imagens:",e),!1}}function me(e){if(!e)return console.log("Imagem não disponível para visualização"),void Ge("Imagem não disponível para este pedido","warning");try{const n=document.getElementById("imageModal");if(!n)return void console.error("Modal de imagem não encontrado");const o=document.getElementById("modalImage"),a=(document.querySelector(".zoom-level"),document.getElementById("zoomIn")),s=document.getElementById("zoomOut");if(!o)return void console.error("Elemento de imagem modal não encontrado");Pe();const i=e.startsWith("data:image")?e:`data:image/jpeg;base64,${e}`;o.src=i,function(e,t,n){let o=document.getElementById("highQualityToggle");if(!o){const t=document.createElement("div");t.className="quality-controls",o=document.createElement("button"),o.id="highQualityToggle",o.title="Alternar modo de alta qualidade",o.innerHTML='<i class="fas fa-glasses"></i> Alta Qualidade',t.appendChild(o),e.appendChild(t)}Le=!1,$e=n,Se=null,o.classList.remove("active"),o.innerHTML='<i class="fas fa-glasses"></i> Alta Qualidade',o.onclick=function(e){e.stopPropagation(),function(e,t){Le=!Le,Le?(e.classList.add("loading"),t.disabled=!0,t.innerHTML='<i class="fas fa-spinner fa-spin"></i> Carregando...',Se?(e.src=Se,e.classList.remove("loading"),t.disabled=!1,t.innerHTML='<i class="fas fa-glasses"></i> Modo Normal',t.classList.add("active")):function(e){return new Promise(((t,n)=>{try{const o=new Image;o.onload=function(){try{const e=document.createElement("canvas"),a=e.getContext("2d"),s=Math.max(o.width,1200),i=s/o.width;e.width=s,e.height=o.height*i,a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.drawImage(o,0,0,e.width,e.height),function(e,t,n){try{const o=e.getImageData(0,0,t,n),a=o.data;((e,t,n,o=.5)=>{const a=new Uint8ClampedArray(e);for(let s=1;s<n-1;s++)for(let n=1;n<t-1;n++){const i=4*(s*t+n);for(let n=0;n<3;n++){const s=a[i+n],r=5*s-a[i-4*t+n]-a[i+4*t+n]-a[i-4+n]-a[i+4+n];e[i+n]=Math.min(255,Math.max(0,s+(r-s)*o))}}})(a,t,n,.3),e.putImageData(o,0,0)}catch(o){console.error("Error applying sharpening:",o)}}(a,e.width,e.height),e.toBlob((e=>{if(e){const o=new FileReader;o.onloadend=()=>t(o.result),o.onerror=e=>n(e),o.readAsDataURL(e)}else n(new Error("Failed to create blob"))}),"image/jpeg",.95)}catch(e){n(e)}},o.onerror=()=>n(new Error("Failed to load image")),o.src=e}catch(o){n(o)}}))}($e).then((n=>{Se=n,Le&&(e.src=Se,t.innerHTML='<i class="fas fa-glasses"></i> Modo Normal',t.classList.add("active")),e.classList.remove("loading"),t.disabled=!1})).catch((n=>{console.error("Erro ao criar versão de alta qualidade:",n),Le=!1,e.src=$e,e.classList.remove("loading"),t.disabled=!1,t.innerHTML='<i class="fas fa-glasses"></i> Alta Qualidade',t.classList.remove("active"),Ge("Não foi possível melhorar a qualidade da imagem","error")}))):(e.src=$e,t.innerHTML='<i class="fas fa-glasses"></i> Alta Qualidade',t.classList.remove("active"));Pe()}(t,o)}}(n,o,i),n.style.display="block",setTimeout((()=>{n.classList.add("show")}),10),a&&(a.onclick=function(){Ce(ue+.5)}),s&&(s.onclick=function(){Ce(ue-.5)}),(t=o).addEventListener("touchstart",De,{passive:!1}),t.addEventListener("touchmove",Be,{passive:!1}),t.addEventListener("touchend",ke,{passive:!1}),t.addEventListener("wheel",Te,{passive:!1}),n.onclick=function(e){e.target!==n||Ie||xe||Me()};const r=function(e){"Escape"===e.key&&(Me(),document.removeEventListener("keydown",r))};document.addEventListener("keydown",r),console.log("Imagem aberta no modal com sucesso")}catch(n){console.error("Erro ao abrir imagem no modal:",n),Ge("Erro ao abrir a imagem","error")}var t}let ue=1,ge=5,pe=.5,ve=0,fe=0,he=0,ye=1,Ee=0,we=0,be=0,Ie=!1,xe=!1,Le=!1,$e=null,Se=null;function De(e){e.preventDefault();const t=document.getElementById("imageModal");if(1===e.touches.length){ve=e.touches[0].clientX-Ee,fe=e.touches[0].clientY-we;const n=(new Date).getTime(),o=n-be;o<300&&o>0&&(ue>1?Pe():Ce(2),e.preventDefault()),be=n,xe=!0,ue>1&&t&&t.classList.add("dragging")}else if(2===e.touches.length){Ie=!0,xe=!1;const n=e.touches[0].clientX-e.touches[1].clientX,o=e.touches[0].clientY-e.touches[1].clientY;he=Math.sqrt(n*n+o*o),ye=ue,t&&t.classList.add("zooming")}}function Be(e){if(e.preventDefault(),Ie&&2===e.touches.length){const t=e.touches[0].clientX-e.touches[1].clientX,n=e.touches[0].clientY-e.touches[1].clientY,o=Math.sqrt(t*t+n*n);let a=ye*(o/he);a=Math.max(pe,Math.min(ge,a)),Ce(a)}else if(xe&&1===e.touches.length&&ue>1){const t=e.touches[0].clientX-ve,n=e.touches[0].clientY-fe,o=document.getElementById("modalImage"),a=o.width*ue,s=o.height*ue,i=window.innerWidth,r=window.innerHeight,c=Math.max(0,(a-i)/2),d=Math.max(0,(s-r)/2);Ee=Math.max(-c,Math.min(c,t)),we=Math.max(-d,Math.min(d,n)),Ne()}}function ke(e){const t=document.getElementById("imageModal");t&&t.classList.remove("dragging","zooming"),Ie=!1,setTimeout((()=>{xe=!1}),100)}function Te(e){e.preventDefault();const t=-.2*Math.sign(e.deltaY),n=Math.max(pe,Math.min(ge,ue+t));if(n!==ue){const e=document.getElementById("imageModal");e&&(e.classList.add("zooming"),setTimeout((()=>{e.classList.remove("zooming")}),300)),Ce(n)}}function Ce(e){ue=Math.max(pe,Math.min(ge,e));const t=document.querySelector(".zoom-level");t&&(t.textContent=`${Math.round(100*ue)}%`),ue<=1&&(Ee=0,we=0),Ne()}function Ne(){const e=document.getElementById("modalImage");e&&(e.style.transform=`translate(${Ee}px, ${we}px) scale(${ue})`)}function Pe(){ue=1,Ee=0,we=0,Ie=!1,xe=!1;const e=document.querySelector(".zoom-level");e&&(e.textContent="100%");const t=document.getElementById("modalImage");t&&(t.style.transform="translate(0px, 0px) scale(1)")}function Me(){const e=document.getElementById("imageModal"),t=document.getElementById("modalImage"),n=document.getElementById("highQualityToggle");if(e){e.classList.remove("show","dragging","zooming"),t&&(t.removeEventListener("touchstart",De),t.removeEventListener("touchmove",Be),t.removeEventListener("touchend",ke),t.removeEventListener("wheel",Te));const o=document.getElementById("zoomIn"),a=document.getElementById("zoomOut");o&&(o.onclick=null),a&&(a.onclick=null),n&&(n.onclick=null),$e=null,Se=null,Le=!1,setTimeout((()=>{e.style.display="none",e.onclick=null,Pe()}),300)}}function Re(){return(new Date).toLocaleDateString("en-CA")}function ze(e){if(!e)return"";const t=new Date(e+"T12:00:00");return isNaN(t.getTime())?"":t.toLocaleDateString("pt-BR")}function Ae(e){if(!e)return"";const t=new Date(e+"T12:00:00");return isNaN(t.getTime())?"":t.toLocaleDateString("en-CA")}function Oe(e){return isNaN(e)?"0,00":e.toFixed(2).replace(".",",").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1.")}function Fe(e){return["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"][new Date(e+"T00:00:00").getDay()]}function qe(e){if(!e)return"";const[t,n,o]=e.split("/");return`${o}-${n.padStart(2,"0")}-${t.padStart(2,"0")}`}function Ge(e,t="info",n=3e3){const o=document.createElement("div");return o.className=`toast toast-${t}`,o.textContent=e,document.body.appendChild(o),setTimeout((()=>{o.classList.add("show")}),100),0!==n&&setTimeout((()=>{o.classList.remove("show"),setTimeout((()=>{document.body.contains(o)&&document.body.removeChild(o)}),300)}),n),o}function je(e){var t;if(!(null==(t=e.orderNumber)?void 0:t.trim()))return"O número do pedido é obrigatório";if(!e.date)return"A data é obrigatória";if(!/^\d{4}-\d{2}-\d{2}$/.test(e.date))return"Formato de data inválido. Use YYYY-MM-DD";if(void 0!==e.fee&&null!==e.fee&&""!==e.fee){const t=parseFloat(e.fee);if(isNaN(t))return"Taxa inválida";if(t<0)return"A taxa não pode ser negativa"}return e.image?null:"O comprovante é obrigatório"}function _e(){f.sort(((e,t)=>{const n=new Date(t.date)-new Date(e.date);return 0!==n?n:e.orderNumber.localeCompare(t.orderNumber,void 0,{numeric:!0,sensitivity:"base"})}))}function He(e,t,n=null){const o=Ae(t);return f.some((t=>t.orderNumber===e&&t.date===o&&(!n||t.id!==n)))}const Ue={currentEditId:null,isEditing:!1,hasUnsavedChanges:!1,isProcessingImage:!1};let Ve=0;function We(e){Ue.hasUnsavedChanges=e;const t=document.getElementById("unsavedChangesNotice");t&&t.classList.toggle("active",e)}function Je(e){const t=(n=e,f.find((e=>e.id===n))||null);var n;if(!t)return void Ge("Pedido não encontrado","error");Ve=window.pageYOffset,document.body.classList.add("modal-open"),document.body.style.top=`-${Ve}px`,Ue.currentEditId=e,Ue.isEditing=!0,Ue.isProcessingImage=!1,We(!1),document.getElementById("editOrderNumber").value=t.orderNumber,document.getElementById("editFee").value=t.fee||"",document.getElementById("editDate").value=t.date;const o=document.getElementById("editStatus");if(o){const e=parseFloat(t.fee)>0,n="pending"===t.status;o.checked=e&&n}document.getElementById("editOrderNumberError").textContent="",document.getElementById("editDateError").textContent="",document.getElementById("editImageError").textContent="";const a=document.getElementById("editImagePreview");if(a.innerHTML="",t.image){const e=document.createElement("img");e.src=`data:image/jpeg;base64,${t.image}`,e.alt="Preview",e.className="preview-image",a.innerHTML=`\n      <div class="image-preview-item">\n        <img src="${e.src}" \n            alt="Preview" \n            class="preview-image">\n        <button type="button" class="delete-image" onclick="clearEditImage()">×</button>\n      </div>\n    `}document.getElementById("editModal").classList.add("active"),setTimeout((()=>{document.getElementById("editOrderNumber").focus()}),100),function(){const e=document.getElementById("editForm");document.getElementById("cancelEdit"),document.getElementById("editUploadButton"),document.getElementById("editImage");const t=document.getElementById("editModal"),n=e.cloneNode(!0);e.parentNode.replaceChild(n,e);const o=document.getElementById("cancelEdit"),a=document.getElementById("editUploadButton"),s=document.getElementById("editImage"),i=n.querySelectorAll("input");n.addEventListener("submit",Xe),o.addEventListener("click",Ze),t.addEventListener("click",Ye),a.addEventListener("click",(()=>{Ue.isProcessingImage?Ge("Aguarde o processamento da imagem atual...","info"):(s.value="",s.click())})),s.addEventListener("change",Qe),i.forEach((e=>{e.addEventListener("change",(()=>We(!0))),e.addEventListener("input",(()=>We(!0)))})),window.clearEditImage=()=>{const e=document.getElementById("editImagePreview"),t=document.getElementById("editImageError");e&&(e.innerHTML=""),t&&(t.textContent="O comprovante é obrigatório"),We(!0)}}()}function Ye(e){const t=document.getElementById("editModal");if(e.target===t){if(Ue.hasUnsavedChanges){const e=document.getElementById("unsavedChangesNotice");return e.classList.add("active"),void setTimeout((()=>{e.classList.remove("active")}),3e3)}Ke()}}const Qe=function(e,t){let n;return function(...o){clearTimeout(n),n=setTimeout((()=>e.apply(this,o)),t)}}((async function(e){var t;if(Ue.isProcessingImage)return void console.log("Já existe um processamento de imagem em andamento, aguardando...");const n=null==(t=e.target.files)?void 0:t[0];if(n)try{Ue.isProcessingImage=!0;const e=document.getElementById("editImagePreview"),t=document.getElementById("editImageError"),o=document.getElementById("editImage");if(o){const e=o.cloneNode(!0);o.parentNode.replaceChild(e,o),e.addEventListener("change",Qe)}t&&(t.textContent=""),e&&(e.innerHTML='<div class="processing-indicator">Processando imagem...</div>');const a=await ce(n);a&&e?(e.innerHTML=`\n        <div class="image-preview-item">\n          <img src="${a}" \n               alt="Preview" \n               class="preview-image">\n          <button type="button" class="delete-image" onclick="clearEditImage()">×</button>\n        </div>\n      `,We(!0)):(e&&(e.innerHTML=""),t&&(t.textContent="Erro ao processar a imagem. Tente novamente."))}catch(o){console.error("Erro ao processar imagem:",o);const e=document.getElementById("editImagePreview"),t=document.getElementById("editImageError");e&&(e.innerHTML=""),t&&(t.textContent="Erro ao processar a imagem. Verifique o tamanho e formato.")}finally{Ue.isProcessingImage=!1}}),300);async function Xe(e){var t,n;e.preventDefault();const o=document.getElementById("editOrderNumber").value.trim(),a=document.getElementById("editFee").value,s=document.getElementById("editDate").value,i=null==(t=document.getElementById("editImagePreview").querySelector("img"))?void 0:t.src,r=(null==(n=document.getElementById("editStatus"))?void 0:n.checked)||!1;try{const e=i?i.replace(/^data:image\/\w+;base64,/,""):null,t=parseFloat(a)||0,n=r?"pending":t>0?"completed":"pending";await function(e,t){try{const n=f.findIndex((t=>t.id===e));if(-1===n)throw new Error("Pedido não encontrado");const o=f[n],a=parseFloat(t.fee)||0,s=t.status||(a>0?"completed":"pending"),i={...o,...t,fee:a,date:Ae(t.date||o.date),id:o.id,status:s},r=je(i);if(r)throw new Error(r);if(He(i.orderNumber,i.date,e))throw new Error("Já existe um pedido com este número nesta data");return f[n]=i,_e(),w(),i}catch(n){throw new Error(`Erro ao atualizar pedido: ${n.message}`)}}(Ue.currentEditId,{orderNumber:o,fee:a,date:s,image:e,status:n});Ge("Pedido atualizado com sucesso!","success"),Ke(),S()}catch(c){console.error("Erro ao atualizar pedido:",c),Ge(c.message,"error")}}function Ze(){Ue.hasUnsavedChanges?confirm("Existem alterações não salvas. Deseja realmente sair?")&&Ke():Ke()}function Ke(){document.getElementById("editModal").classList.remove("active"),document.body.classList.remove("modal-open"),document.body.style.top="",window.scrollTo(0,Ve),Ue.currentEditId=null,Ue.isEditing=!1,Ue.isProcessingImage=!1,We(!1),document.getElementById("editForm").reset(),document.getElementById("editImagePreview").innerHTML=""}async function et(e){var t;e.preventDefault();const n=document.getElementById("orderNumber").value.trim(),o=document.getElementById("fee").value.trim(),a=document.getElementById("date").value,s=document.getElementById("imagePreview"),i=null==(t=s.querySelector("img"))?void 0:t.src;try{if(He(n,a)){const e=function(e){const t=Ae(e);return f.filter((e=>e.date===t))}(a),t=e.find((e=>e.orderNumber===n));if(confirm(`Já existe um pedido #${n} registrado em ${a}.\nTaxa: R$ ${t.fee}\n\nDeseja editar o pedido existente?`))return void window.editDelivery(t.id);throw new Error("Operação cancelada. Escolha um número de pedido diferente.")}const t=i?i.replace(/^data:image\/\w+;base64,/,""):null;await async function(e){try{const t=je(e);if(t)throw new Error(t);if(He(e.orderNumber,e.date))throw new Error("Já existe um pedido com este número nesta data");const n=parseFloat(e.fee)||0,o=n>0?"completed":"pending",a={id:String(Date.now()),orderNumber:e.orderNumber.trim(),fee:n,date:e.date,image:e.image,status:o,createdAt:(new Date).toISOString()};return f.push(a),_e(),w(),a}catch(t){throw console.error("Erro ao criar pedido:",t),t}}({orderNumber:n,fee:""===o?null:o,date:a,image:t}),e.target.reset(),s.innerHTML="",document.getElementById("imageError").textContent="",document.getElementById("date").value=Re(),I(),M(),Ge("Pedido registrado com sucesso!","success")}catch(r){console.error("Erro ao criar pedido:",r),Ge(r.message,"error")}}function tt(e){e.preventDefault();const t=document.getElementById("gasAmount").value.trim(),n=document.getElementById("gasDate").value;try{if(!t||!n)throw new Error("Todos os campos são obrigatórios");const o={id:String(Date.now()),amount:parseFloat(t),date:n};h.push(o),b(),e.target.reset(),document.getElementById("gasDate").value=Re(),D(),$(),M(),Ge("Registro de gasolina adicionado com sucesso!","success")}catch(o){console.error("Erro ao adicionar registro de gasolina:",o),Ge(o.message,"error")}}let nt=!1;const ot=function(e,t){let n;return function(...o){clearTimeout(n),n=setTimeout((()=>e.apply(this,o)),t)}}((async function(e){var t;if(nt)return void console.log("Já existe um processamento de imagem em andamento, aguardando...");const n=null==(t=e.target.files)?void 0:t[0];if(n)try{nt=!0;const e=document.getElementById("imagePreview"),t=document.getElementById("imageError"),o=document.getElementById("image");if(t&&(t.textContent=""),e&&(e.innerHTML='<div class="processing-indicator">Processando imagem...</div>'),function(){const e=document.getElementById("imagePreview");if(!e)return;const t=e.querySelectorAll("img");t&&t.length&&t.forEach((e=>{e.src&&e.src.startsWith("blob:")&&URL.revokeObjectURL(e.src),e.src=""}));e.innerHTML=""}(),o){const e=o.cloneNode(!0);o.parentNode.replaceChild(e,o),e.addEventListener("change",ot)}const a=10485760;if(n.size>a)throw e.innerHTML="",new Error("Imagem muito grande. O tamanho máximo permitido é 10MB.");if(!["image/jpeg","image/png","image/webp"].includes(n.type))throw e.innerHTML="",new Error("Tipo de arquivo não suportado. Use JPG, PNG ou WebP.");let s;const i=new Promise(((e,t)=>{s=setTimeout((()=>{t(new Error("Tempo limite excedido ao processar a imagem. Tente uma imagem menor."))}),3e4)})),r=await Promise.race([ce(n),i]).finally((()=>{clearTimeout(s)}));if(r){e.innerHTML="";const t=document.createElement("div");t.className="image-preview-item";const n=document.createElement("img");n.src=r,n.alt="Preview",n.className="preview-image";const o=document.createElement("button");o.type="button",o.className="delete-image",o.textContent="×",o.onclick=function(){clearOrderImage(),n.src.startsWith("blob:")&&URL.revokeObjectURL(n.src),n.src=""},t.appendChild(n),t.appendChild(o),e.appendChild(t)}else e.innerHTML="",t.textContent="Erro ao processar a imagem. Tente novamente."}catch(o){console.error("Erro ao processar imagem:",o);const e=document.getElementById("imagePreview"),t=document.getElementById("imageError");e&&(e.innerHTML=""),t&&(t.textContent=o.message||"Erro ao processar a imagem. Verifique o tamanho e formato.")}finally{nt=!1,setTimeout((()=>{if(window.gc)try{window.gc()}catch(e){}}),500)}}),300);function at(){const e=document.getElementById("deliveryForm");document.getElementById("uploadButton"),document.getElementById("image"),document.getElementById("orderNumber");if(document.getElementById("date").value=Re(),e){const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("submit",et)}const t=document.getElementById("uploadButton"),n=document.getElementById("image"),o=document.getElementById("orderNumber"),a=document.getElementById("date");t&&n&&(t.addEventListener("click",(()=>{nt?Ge("Aguarde o processamento da imagem atual...","info"):(n.value="",n.click())})),n.addEventListener("change",ot)),o&&a&&(o.addEventListener("input",(()=>{const e=o.value.trim(),t=a.value;e&&t&&He(e,t)?(o.classList.add("invalid"),o.title=`Pedido #${e} já existe em ${t}`):(o.classList.remove("invalid"),o.title="")})),a.addEventListener("change",(()=>{const e=o.value.trim(),t=a.value;e&&t&&He(e,t)?(o.classList.add("invalid"),o.title=`Pedido #${e} já existe em ${t}`):(o.classList.remove("invalid"),o.title="")}))),window.clearOrderImage=()=>{const e=document.getElementById("imagePreview"),t=document.getElementById("imageError");e&&(e.innerHTML=""),t&&(t.textContent="O comprovante é obrigatório")}}function st(){const e=document.getElementById("gasForm");document.getElementById("gasDate").value=Re(),e.onsubmit=null,e.addEventListener("submit",tt)}const it={};function rt(e=!1){console.time("Diagnóstico de Dados");const t=o(),n=function(e){const t={deliveryIssues:[],gasIssues:[]},n=new Map;e.deliveries.invalidItems.forEach((e=>{e.errors.forEach((t=>{const o=`${t.field}:${t.message}`;n.has(o)||n.set(o,{field:t.field,message:t.message,items:[],count:0}),n.get(o).items.push(e.item),n.get(o).count++}))})),t.deliveryIssues=Array.from(n.values());const o=new Map;return e.gasEntries.invalidItems.forEach((e=>{e.errors.forEach((t=>{const n=`${t.field}:${t.message}`;o.has(n)||o.set(n,{field:t.field,message:t.message,items:[],count:0}),o.get(n).items.push(e.item),o.get(n).count++}))})),t.gasIssues=Array.from(o.values()),t}(t);if(console.group("Relatório de Diagnóstico de Dados"),console.log("Status: "+(t.isValid?"ÍNTEGRO ✅":"COM PROBLEMAS ❌")),console.log(`Timestamp: ${new Date(t.timestamp).toLocaleString()}`),console.group("Entregas"),console.log(`Total: ${f.length}`),console.log(`Válidas: ${t.deliveries.validItems.length}`),console.log(`Inválidas: ${t.deliveries.invalidItems.length}`),t.deliveries.invalidItems.length>0&&(console.group("Problemas encontrados"),n.deliveryIssues.forEach(((e,t)=>{console.log(`🔍 Problema #${t+1}: ${e.message} (${e.count} ocorrências)`)})),console.groupEnd()),console.groupEnd(),console.group("Abastecimentos"),console.log(`Total: ${h.length}`),console.log(`Válidos: ${t.gasEntries.validItems.length}`),console.log(`Inválidos: ${t.gasEntries.invalidItems.length}`),t.gasEntries.invalidItems.length>0&&(console.group("Problemas encontrados"),n.gasIssues.forEach(((e,t)=>{console.log(`🔍 Problema #${t+1}: ${e.message} (${e.count} ocorrências)`)})),console.groupEnd()),console.groupEnd(),console.groupEnd(),console.timeEnd("Diagnóstico de Dados"),t.isValid)Ge("Dados verificados. Nenhum problema encontrado.","success");else{const n=t.deliveries.invalidItems.length+t.gasEntries.invalidItems.length;if(e){const e=ct(t);Ge(`Encontrados ${n} problemas. Reparo automático: ${e.success?"Sucesso":"Falha"} (${e.fixed}/${n} corrigidos)`,"warning")}else Ge(`Diagnóstico encontrou ${n} problemas de integridade. Verifique o console para detalhes.`,"error")}return{result:t,report:n}}function ct(e){console.time("Reparo de Dados");const t={success:!1,fixed:0,total:0,deliveryFixed:0,gasFixed:0,unrepaired:[]};return t.total=e.deliveries.invalidItems.length+e.gasEntries.invalidItems.length,e.deliveries.invalidItems.forEach((e=>{const n=f.findIndex((t=>t.id===e.item.id));if(-1!==n){let o=!1;e.errors.forEach((e=>{switch(e.field){case"status":f[n].status=parseFloat(f[n].fee)>0?"completed":"pending",o=!0;break;case"id":f[n].id||(f[n].id=`repair_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,o=!0);break;case"date":if(f[n].date)try{const e=new Date(f[n].date);isNaN(e.getTime())||(f[n].date=e.toISOString().split("T")[0],o=!0)}catch(t){}break;case"fee":if(void 0!==f[n].fee){const e=parseFloat(f[n].fee);isNaN(e)?(f[n].fee=0,o=!0):(f[n].fee=e,o=!0)}break;case"orderNumber":f[n].orderNumber||(f[n].orderNumber=`REPARO_${n+1}`,o=!0)}})),o?(t.fixed++,t.deliveryFixed++):t.unrepaired.push({type:"delivery",id:e.item.id,errors:e.errors})}})),e.gasEntries.invalidItems.forEach((e=>{const n=h.findIndex((t=>t.id===e.item.id));if(-1!==n){let o=!1;e.errors.forEach((e=>{switch(e.field){case"id":h[n].id||(h[n].id=`repair_gas_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,o=!0);break;case"date":if(h[n].date)try{const e=new Date(h[n].date);isNaN(e.getTime())||(h[n].date=e.toISOString().split("T")[0],o=!0)}catch(t){}break;case"amount":if(void 0!==h[n].amount){const e=parseFloat(h[n].amount);!isNaN(e)&&e>0?(h[n].amount=e,o=!0):!isNaN(e)&&e<=0&&(h[n].amount=.01,o=!0)}}})),o?(t.fixed++,t.gasFixed++):t.unrepaired.push({type:"gasEntry",id:e.item.id,errors:e.errors})}})),t.deliveryFixed>0&&w(),t.gasFixed>0&&b(),t.fixed>0&&($(),T()),t.success=t.fixed>0,console.timeEnd("Reparo de Dados"),console.log("Resultado do reparo:",t),t}function dt(){const e=rt(!1);let t=document.getElementById("diagnosticModal");t||(t=document.createElement("div"),t.id="diagnosticModal",t.className="modal-overlay",document.body.appendChild(t));const n=e.result.isValid,o=e.result.deliveries.invalidItems.length+e.result.gasEntries.invalidItems.length;t.innerHTML=`\n    <div class="diagnostic-modal">\n      <h2>Diagnóstico de Integridade de Dados</h2>\n      \n      <div class="diagnostic-summary ${n?"valid":"invalid"}">\n        <div class="diagnostic-status">\n          <span class="status-icon">${n?"✅":"❌"}</span>\n          <span class="status-text">${n?"Dados Íntegros":"Problemas Encontrados"}</span>\n        </div>\n        <div class="diagnostic-counts">\n          <div class="count-item">\n            <span class="count-value">${f.length}</span>\n            <span class="count-label">Entregas Totais</span>\n          </div>\n          <div class="count-item">\n            <span class="count-value">${h.length}</span>\n            <span class="count-label">Abastecimentos Totais</span>\n          </div>\n          <div class="count-item ${o>0?"invalid":""}">\n            <span class="count-value">${o}</span>\n            <span class="count-label">Problemas</span>\n          </div>\n        </div>\n      </div>\n      \n      ${o>0?`\n        <div class="diagnostic-issues">\n          <h3>Problemas Encontrados</h3>\n          \n          ${e.report.deliveryIssues.length>0?`\n            <div class="issue-group">\n              <h4>Problemas em Entregas</h4>\n              <ul class="issue-list">\n                ${e.report.deliveryIssues.map((e=>`\n                  <li class="issue-item">\n                    <div class="issue-header">\n                      <span class="issue-field">${e.field}</span>\n                      <span class="issue-count">${e.count} ocorrência${1!==e.count?"s":""}</span>\n                    </div>\n                    <div class="issue-message">${e.message}</div>\n                  </li>\n                `)).join("")}\n              </ul>\n            </div>\n          `:""}\n          \n          ${e.report.gasIssues.length>0?`\n            <div class="issue-group">\n              <h4>Problemas em Abastecimentos</h4>\n              <ul class="issue-list">\n                ${e.report.gasIssues.map((e=>`\n                  <li class="issue-item">\n                    <div class="issue-header">\n                      <span class="issue-field">${e.field}</span>\n                      <span class="issue-count">${e.count} ocorrência${1!==e.count?"s":""}</span>\n                    </div>\n                    <div class="issue-message">${e.message}</div>\n                  </li>\n                `)).join("")}\n              </ul>\n            </div>\n          `:""}\n          \n          <div class="repair-actions">\n            <button id="autoRepairBtn" class="button primary">Reparar Automaticamente</button>\n            <p class="repair-note">O reparo automático tentará corrigir os problemas mais comuns. É recomendado fazer um backup antes.</p>\n          </div>\n        </div>\n      `:'\n        <div class="diagnostic-valid">\n          <p>Todos os dados foram verificados e estão íntegros.</p>\n        </div>\n      '}\n      \n      <div class="modal-actions">\n        <button id="closeDiagnosticBtn" class="button outline">Fechar</button>\n        <button id="backupBeforeRepairBtn" class="button outline">Fazer Backup</button>\n      </div>\n    </div>\n  `,t.style.display="flex",document.getElementById("closeDiagnosticBtn").addEventListener("click",(()=>{t.style.display="none"})),document.getElementById("backupBeforeRepairBtn").addEventListener("click",(()=>{(function(e,t){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),o=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));n=Promise.allSettled(t.map((e=>{if((e=function(e){return"/entrega-financeira-semanal/"+e}(e))in it)return;it[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script"),a.crossOrigin="",a.href=e,o&&a.setAttribute("nonce",o),document.head.appendChild(a),t?new Promise(((t,n)=>{a.addEventListener("load",t),a.addEventListener("error",(()=>n(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function o(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then((t=>{for(const e of t||[])"rejected"===e.status&&o(e.reason);return e().catch(o)}))})((()=>Promise.resolve().then((()=>X))),void 0).then((e=>{e.backupData(),Ge("Backup criado com sucesso","success")}))})),o>0&&document.getElementById("autoRepairBtn").addEventListener("click",(()=>{const n=ct(e.result);n.success?(Ge(`Reparo: ${n.fixed}/${o} problemas corrigidos`,"success"),setTimeout((()=>{t.style.display="none",dt()}),1500)):Ge("Não foi possível reparar os problemas automaticamente","error")})),t.querySelector(".diagnostic-modal").addEventListener("click",(e=>{e.stopPropagation()})),t.addEventListener("click",(()=>{t.style.display="none"}))}const lt={isOpen:!1,itemId:null,itemType:null,expectedValue:"",onConfirm:null,valueType:"numero"};let mt,ut,gt,pt,vt,ft;function ht(e,t){lt.itemId=e,lt.itemType="delivery",lt.expectedValue=t,lt.valueType="numero",lt.onConfirm=()=>{B(e)},ut.textContent=`Para confirmar a exclusão, digite o número do pedido: ${t}`,gt.placeholder="Digite o número do pedido",Et()}function yt(e,t){lt.itemId=e,lt.itemType="gas",lt.expectedValue=t.toString(),lt.valueType="valor",lt.onConfirm=()=>{k(e)},ut.textContent=`Para confirmar a exclusão, digite o valor do abastecimento: ${t}`,gt.placeholder="Digite o valor",Et()}function Et(){mt.style.display="flex",gt.value="",pt.textContent="",gt.classList.remove("error"),setTimeout((()=>{gt.focus(),lt.isOpen=!0}),50)}function wt(){mt.style.display="none",lt.isOpen=!1,lt.itemId=null,lt.expectedValue="",lt.onConfirm=null}function bt(){pt.textContent="",gt.classList.remove("error")}function It(){const e=gt.value.trim();if(e){if("numero"===lt.valueType){if(e!==lt.expectedValue)return void xt("O número do pedido não corresponde.")}else{const t=parseFloat(e.replace(",",".")),n=parseFloat(lt.expectedValue.replace(",","."));if(isNaN(t)||Math.abs(t-n)>.01)return void xt("O valor não corresponde.")}lt.onConfirm&&(lt.onConfirm(),wt())}else xt("Este campo é obrigatório.")}function xt(e){pt.textContent=e,gt.classList.add("error"),gt.focus()}function Lt(){const e=document.getElementById("imageModal");e.querySelector(".close").addEventListener("click",St),e.addEventListener("click",(t=>{t.target===e&&St()}));const t=document.getElementById("finishWeekButton");t&&(t.onclick||t.addEventListener("click",H),t.title="Exportar dados e limpar todas as entregas");const n=document.getElementById("clearDataButton");if(n){n.replaceWith(n.cloneNode(!0));const e=document.getElementById("clearDataButton");e.addEventListener("click",(()=>{confirm("ATENÇÃO: Todos os dados serão permanentemente excluídos. Esta ação não pode ser desfeita.\n\nDeseja continuar?")&&(j(),setTimeout((()=>{if(0===localStorage.length)console.log("Limpeza de dados validada com sucesso");else{console.warn("Possível falha na limpeza - ainda existem dados no localStorage");try{localStorage.clear(),sessionStorage.clear(),I(),x(),$(),Ge("Dados limpos (fallback)","info")}catch(e){console.error("Erro na limpeza fallback:",e)}}forceSyncAllTabs()}),500))})),e.title="Limpar todos os dados"}const o=document.getElementById("importButton"),a=document.getElementById("csvInput");o&&a&&(o.onclick||o.addEventListener("click",(()=>{a.click()})),a.onchange||a.addEventListener("change",A)),function(){const e=document.getElementById("exportModal"),t=document.getElementById("confirmExport"),n=document.getElementById("cancelExport");e&&t&&n&&(t.onclick||t.addEventListener("click",(()=>{try{const t=document.getElementById("exportDeliveries").checked,n=document.getElementById("exportGas").checked;W(t,n,document.getElementById("exportImages").checked),e.style.display="none"}catch(t){console.error("Erro ao exportar dados:",t),Ge(t.message,"error")}})),n.onclick||n.addEventListener("click",(()=>{e.style.display="none"})))}(),window.addEventListener("storage",(e=>{"deliveries"!==e.key&&"gasEntries"!==e.key||(I(),x())})),window.editDelivery=Je,window.deleteDelivery=B,window.deleteGasEntry=k,window.showImageModal=me,window.cancelDeliveryEdit=Ke,window.confirmDeliveryDeletion=ht,window.confirmGasDeletion=yt,window.generateTestData=e=>{try{const t=function(e=7){const t=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,n=e=>{const t=new Date;return t.setDate(t.getDate()-e),t.toISOString().split("T")[0]};f.length=0,h.length=0;for(let o=0;o<e;o++){const e=n(o),a=t(3,8);for(let n=0;n<a;n++){const a=parseFloat(t(5,15).toFixed(2)),s={id:`${Date.now()}-${o}-${n}`,date:e,orderNumber:`${t(1e3,9999)}`,fee:a,image:null,status:a>0?"completed":"pending"};f.push(s)}if(Math.random()>.5){const n={id:`gas-${Date.now()}-${o}`,date:e,amount:parseFloat(t(30,70).toFixed(2)),image:null};h.push(n)}}return w(),b(),$(),Ge(`Dados aleatórios gerados para ${e} dias!`,"success"),{totalDeliveries:f.length,totalGasEntries:h.length}}(e);return console.log("Dados gerados:",t),t}catch(t){console.error("Erro ao gerar dados:",t),Ge("Erro ao gerar dados de teste","error")}},I(),M()}function $t(){const e=document.querySelectorAll(".tab-button"),t=document.querySelectorAll(".tab-content");e.forEach((n=>{n.addEventListener("click",(()=>{e.forEach((e=>e.classList.remove("active"))),t.forEach((e=>e.classList.remove("active"))),n.classList.add("active");const o=n.getAttribute("data-tab");document.getElementById(o).classList.add("active"),"analytics"===o&&(0===f.length&&Ge("Nenhuma entrega registrada para análise","info"),M())}))}))}function St(){const e=document.getElementById("imageModal");e.classList.remove("show"),setTimeout((()=>{e.style.display="none"}),300)}function Dt(){const e=document.querySelector(".loading-indicator"),t=Promise.all(Array.from(document.querySelectorAll('link[rel="stylesheet"]')).map((e=>e.loaded?Promise.resolve():new Promise((t=>{e.addEventListener("load",t),e.addEventListener("error",t)}))))),n=new Promise((e=>setTimeout(e,1e3)));Promise.race([t,n]).then((()=>{setTimeout((()=>{e&&(e.style.display="none"),document.body.classList.add("ready")}),100)})).catch((()=>{e&&(e.style.display="none"),document.body.classList.add("ready")}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Dt):Dt(),document.addEventListener("scroll",(()=>{document.body.classList.add("is-scrolling"),clearTimeout(window.scrollTimer),window.scrollTimer=setTimeout((()=>{document.body.classList.remove("is-scrolling")}),150)}),{passive:!0}),window.matchMedia("(prefers-reduced-motion: reduce)").matches&&document.body.classList.add("reduce-motion");const Bt=()=>{document.documentElement.style.setProperty("--app-height",`${window.innerHeight}px`)};function kt(){console.time("Inicialização da Aplicação"),Bt(),window.addEventListener("resize",(()=>{Bt()})),function(){try{if(sessionStorage.getItem("integrity_checked"))return;let t=!1;try{const e=localStorage.getItem("deliveries");e&&JSON.parse(e);const t=localStorage.getItem("gasEntries");t&&JSON.parse(t)}catch(e){console.error("Dados corrompidos no localStorage:",e),t=!0}t&&(console.warn("Problemas de integridade encontrados. Reiniciando armazenamento."),localStorage.clear(),sessionStorage.clear(),I(),x(),$(),Ge("Dados reiniciados devido a um problema de integridade","warning")),sessionStorage.setItem("integrity_checked","true")}catch(t){console.error("Erro ao verificar integridade dos dados:",t);try{localStorage.clear(),sessionStorage.clear()}catch(e){console.error("Falha ao limpar dados corrompidos:",e)}}}(),function(){if(!sessionStorage.getItem("integrity_checked")){const e=rt(!1);if(!e.result.isValid){const t=e.result.deliveries.invalidItems.length+e.result.gasEntries.invalidItems.length;if(t>0){const n=ct(e.result);n.success?(console.log(`Reparados automaticamente ${n.fixed}/${t} problemas de integridade.`),n.fixed<t&&setTimeout((()=>{Ge(`Alguns problemas de integridade (${t-n.fixed}/${t}) não puderam ser reparados automaticamente. Use o Diagnóstico de Dados para mais informações.`,"warning")}),1500)):console.warn("Não foi possível reparar automaticamente os problemas de integridade.")}}sessionStorage.setItem("integrity_checked","true")}}(),I(),x(),$(),c();const e=c();console.log("Sistema de sincronização inicializado:",e.sessionId),E(),f.forEach((e=>{e.status||(e.status=parseFloat(e.fee)>0?"completed":"pending")})),w(),at(),st(),Lt(),$t(),mt=document.getElementById("deleteConfirmModal"),ut=document.getElementById("deleteConfirmMessage"),gt=document.getElementById("deleteConfirmInput"),pt=document.getElementById("deleteConfirmError"),vt=document.getElementById("cancelDelete"),ft=document.getElementById("confirmDelete"),mt&&ut&&gt&&pt&&vt&&ft?(vt.addEventListener("click",wt),ft.addEventListener("click",It),gt.addEventListener("input",bt),mt.addEventListener("click",(e=>{e.target===mt&&wt()})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&lt.isOpen&&wt()})),gt.addEventListener("keydown",(e=>{"Enter"===e.key&&lt.isOpen&&It()}))):console.error("Elementos do modal de confirmação não encontrados"),se(),window.showImageModal=me,window.deleteDelivery=B,window.deleteGasEntry=k,window.editDelivery=Je,window.handleEditSubmit=Xe,window.handleCancelEdit=Ze,window.importCSV=A,window.forceSyncData=T,window.getSyncStatus=v,window.runDiagnostic=rt;const t=document.querySelector(".close");t&&t.addEventListener("click",(()=>{const e=document.getElementById("imageModal");e&&(e.style.display="none")})),function(){const e=document.querySelector(".footer");if(e){const t=document.createElement("div");t.className="sync-indicator",t.innerHTML='\n      <span class="sync-status"></span>\n      <span class="sync-text">Sincronização automática ativada</span>\n    ',e.appendChild(t),Tt(),setInterval(Tt,1e4),t.addEventListener("click",(()=>{t.classList.add("syncing"),T(),Ge("Sincronizando dados...","info"),setTimeout((()=>{t.classList.remove("syncing"),Tt()}),1e3)}))}}(),console.timeEnd("Inicialização da Aplicação")}function Tt(){const e=v(),t=document.querySelector(".sync-status"),n=document.querySelector(".sync-text");if(t&&n){const o=e.isPrimary,a=e.lastSyncTime?new Date(e.lastSyncTime):null,s=new Date;if(t.className="sync-status "+(o?"active":"passive"),a){const e=Math.floor((s-a)/1e3);let t="";t=e<60?`${e}s atrás`:e<3600?`${Math.floor(e/60)}m atrás`:`${Math.floor(e/3600)}h atrás`,n.textContent=`Última sincronização: ${t}`}else n.textContent=o?"Aba principal":"Sincronização automática ativada"}}window.addEventListener("resize",Bt),Bt();window.currentZoom=1;let Ct=window.currentZoom,Nt=0,Pt=0,Mt=!1,Rt=0,zt=0,At=0,Ot=0;const Ft=document.getElementById("imageModal");Ft.querySelector(".modal-content");const qt=document.getElementById("modalImage"),Gt=document.querySelector(".zoom-level"),jt=document.getElementById("zoomIn"),_t=document.getElementById("zoomOut");function Ht(e){Ct=Math.max(1,Math.min(3,e)),window.currentZoom=Ct,qt.style.transform=`scale(${Ct})`,Gt.textContent=`${Math.round(100*Ct)}%`,jt.disabled=Ct>=3,_t.disabled=Ct<=1}function Ut(e,t){const n=e.clientX-t.clientX,o=e.clientY-t.clientY;return Math.sqrt(n*n+o*o)}function Vt(){Ct=1,At=0,Ot=0,qt.style.transform="scale(1)",Gt.textContent="100%",Ft.style.display="none",Ft.classList.remove("show")}qt.addEventListener("wheel",(e=>{e.preventDefault();const t=e.deltaY>0?-.1:.1;Ht(Ct+t)})),qt.addEventListener("touchstart",(e=>{2===e.touches.length?(Nt=Ut(e.touches[0],e.touches[1]),Pt=Nt):1===e.touches.length&&Ct>1&&(Mt=!0,Rt=e.touches[0].clientX-At,zt=e.touches[0].clientY-Ot)})),qt.addEventListener("touchmove",(e=>{if(e.preventDefault(),2===e.touches.length){const t=Ut(e.touches[0],e.touches[1]);Ht(Ct*(t/Pt)),Pt=t}else 1===e.touches.length&&Mt&&(At=e.touches[0].clientX-Rt,Ot=e.touches[0].clientY-zt,qt.style.transform=`scale(${Ct}) translate(${At/Ct}px, ${Ot/Ct}px)`)})),qt.addEventListener("touchend",(()=>{Mt=!1,Nt=0,Pt=0})),jt.addEventListener("click",(()=>{Ht(Ct+.1)})),_t.addEventListener("click",(()=>{Ht(Ct-.1)}));const Wt=Ft.querySelector(".close");async function Jt(e){if(!e)return null;try{const t=new Image,n=new Promise(((e,n)=>{t.onload=()=>e(),t.onerror=()=>n(new Error("Falha ao carregar imagem para otimização"))}));t.src=e,await n;const o=document.createElement("canvas");let a=Math.min(400,t.width),s=Math.round(t.height*(a/t.width));o.width=a,o.height=s;o.getContext("2d").drawImage(t,0,0,a,s);const i=o.toDataURL("image/jpeg",.3);return o.width=0,o.height=0,t.src="",i}catch(t){return console.error("Erro na otimização agressiva de imagem:",t),e}}Wt&&Wt.addEventListener("click",Vt),Ft.addEventListener("click",(function(e){e.target===Ft&&Vt()})),document.addEventListener("keydown",(function(e){"Escape"===e.key&&"block"===Ft.style.display&&Vt()}));const{detectAndRecoverFromMemoryIssues:Yt}={detectAndRecoverFromMemoryIssues:function(){if(!Z())return!1;if(!function(){if(window.performance&&window.performance.memory){const e=window.performance.memory;if(e.jsHeapSizeLimit-e.usedJSHeapSize<314572800)return!1}try{let e=0;for(let t in localStorage)localStorage.hasOwnProperty(t)&&(e+=2*localStorage[t].length/1024/1024);if(e>3.5)return!1}catch(e){console.warn("Error checking localStorage usage:",e)}return!0}()){Ge("Memória do dispositivo baixa. Otimizando...","warning");return document.querySelectorAll('img[src^="blob:"]').forEach((e=>{e.src.startsWith("blob:")&&URL.revokeObjectURL(e.src)})),setTimeout((()=>{!function(){if(Z())try{const e=JSON.parse(localStorage.getItem("deliveries")||"[]");if(!e.length)return;Ge("Otimizando imagens para economizar memória...","info");const t=2;let n=0;const o=async()=>{const a=e.slice(n,n+t).filter((e=>e.image&&e.image.length>2e4));for(const e of a)try{if(e.image&&e.image.length>2e4){const t=`data:image/jpeg;base64,${e.image}`,n=await Jt(t);n&&(e.image=n.replace(/^data:image\/\w+;base64,/,""))}}catch(s){console.error("Error optimizing image for delivery:",e.id,s)}n+=a.length,localStorage.setItem("deliveries",JSON.stringify(e)),n<e.length?setTimeout(o,100):Ge("Otimização de imagens concluída!","success")};return o(),!0}catch(e){return console.error("Erro ao otimizar imagens armazenadas:",e),!1}}()}),1e3),!0}return!1}},Qt={};function Xt(){return import.meta&&Qt||window.location.pathname.includes("/entrega-financeira-semanal/")?"/entrega-financeira-semanal/":"/"}function Zt(e){const t=Xt();if(e&&(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("//")||e.startsWith("data:")))return e;return`${t}${e.startsWith("/")?e.substring(1):e}`}function Kt(e){if(!e)return;if(e.style&&e.style.backgroundImage){const t=e.style.backgroundImage.match(/url\(['"]?([^'")]+)['"]?\)/);if(t&&t[1]){const n=Zt(t[1]);e.style.backgroundImage=`url('${n}')`}}if(["src","href","data-src","poster"].forEach((t=>{if(e.hasAttribute(t)){const n=e.getAttribute(t);!n||n.startsWith("#")||n.startsWith("javascript:")||e.setAttribute(t,Zt(n))}})),e.hasAttribute("srcset")){const t=e.getAttribute("srcset").split(",").map((e=>{const[t,n]=e.trim().split(/\s+/);return`${Zt(t)} ${n||""}`.trim()})).join(", ");e.setAttribute("srcset",t)}}function en(){window.__APP_BASE_PATH=Xt(),document.addEventListener("DOMContentLoaded",(()=>{document.querySelectorAll("img").forEach(Kt),document.querySelectorAll("a").forEach(Kt),document.querySelectorAll("video, audio").forEach((e=>{Kt(e),e.querySelectorAll("source").forEach(Kt)})),console.log("Base path initialized:",window.__APP_BASE_PATH)}))}en(),en(),document.addEventListener("DOMContentLoaded",(async()=>{try{const e=document.querySelector(".container");K(),ee(),await Promise.all([I(),x()]),$(),te(),at(),st(),Lt(),$t(),kt(),function(){try{if(!(Ft&&qt&&Gt&&jt&&_t))return void console.error("Elementos do modal de imagem não encontrados");Ht(1),window.resetImageZoom=Vt,console.log("Zoom de imagem inicializado com sucesso")}catch(e){console.error("Erro ao inicializar o zoom de imagem:",e)}}();const t=document.getElementById("exportButton");t&&t.addEventListener("click",V),window.addEventListener("beforeunload",(()=>{K()}));const n=document.querySelectorAll(".tab-button");n.length&&n.forEach((e=>{e.addEventListener("click",(()=>{setTimeout((()=>K()),100)}))})),setTimeout((()=>{Yt()}),2e3),e&&(e.classList.add("loaded"),K()),console.log("Aplicação inicializada com sucesso")}catch(e){console.error("Erro ao inicializar aplicação:",e);const t=document.querySelector(".container");t&&t.classList.add("loaded")}})),document.addEventListener("DOMContentLoaded",(()=>{kt();const e=document.getElementById("diagnosticButton");e&&e.addEventListener("click",dt)}));
//# sourceMappingURL=index.CiUHYS5-.js.map
